import{S as D}from"./index-BOvYCoiN.js";import{g as M,O,b as $,Q as q}from"./index-BXj-mBhB.js";import{r as B}from"./readable-BmS1kvD9.js";const m="http://www.w3.org/1999/02/22-rdf-syntax-ns#",j="http://www.w3.org/2001/XMLSchema#",S="http://www.w3.org/2000/10/swap/",f={xsd:{decimal:`${j}decimal`,boolean:`${j}boolean`,double:`${j}double`,integer:`${j}integer`,string:`${j}string`},rdf:{type:`${m}type`,nil:`${m}nil`,first:`${m}first`,rest:`${m}rest`,langString:`${m}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${S}reify#forSome`,forAll:`${S}reify#forAll`},log:{implies:`${S}log#implies`}};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let I;var G=typeof queueMicrotask=="function"?queueMicrotask.bind(window):n=>(I||(I=Promise.resolve())).then(n).catch(e=>setTimeout(()=>{throw e},0));const U=M(G),{xsd:R}=f,Q=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,F={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},z=/[\x00-\x20<>\\"\{\}\|\^\`]/,H={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},Z=/$0^/;class V{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const i in this)!(i in H)&&this[i]instanceof RegExp&&(this[i]=Z)}else this._n3Mode=e.n3!==!1;this._comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,i){let t=this._input,s=t.length;for(;;){let u,c;for(;u=this._newline.exec(t);)this._comments&&(c=this._comment.exec(u[0]))&&a("comment",c[1],"",this._line,u[0].length),t=t.substr(u[0].length,t.length),s=t.length,this._line++;if(!u&&(u=this._whitespace.exec(t))&&(t=t.substr(u[0].length,t.length)),this._endOfFile.test(t))return i&&(this._comments&&(c=this._comment.exec(t))&&a("comment",c[1],"",this._line,t.length),t=null,a("eof","","",this._line,0)),this._input=t;const N=this._line,g=t[0];let l="",d="",p="",h=null,_=0,b=!1;switch(g){case"^":if(t.length<3)break;if(t[1]==="^"){if(this._previousMarker="^^",t=t.substr(2),t[0]!=="<"){b=!0;break}}else{this._n3Mode&&(_=1,l="^");break}case"<":if(h=this._unescapedIri.exec(t))l="IRI",d=h[1];else if(h=this._iri.exec(t)){if(d=this._unescape(h[1]),d===null||z.test(d))return r(this);l="IRI"}else t.length>1&&t[1]==="<"?(l="<<",_=2):this._n3Mode&&t.length>1&&t[1]==="="&&(l="inverse",_=2,d=">");break;case">":t.length>1&&t[1]===">"&&(l=">>",_=2);break;case"_":((h=this._blank.exec(t))||i&&(h=this._blank.exec(`${t} `)))&&(l="blank",p="_",d=h[1]);break;case'"':if(h=this._simpleQuotedString.exec(t))d=h[1];else if({value:d,matchLength:_}=this._parseLiteral(t),d===null)return r(this);(h!==null||_!==0)&&(l="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(h=this._simpleApostropheString.exec(t))d=h[1];else if({value:d,matchLength:_}=this._parseLiteral(t),d===null)return r(this);(h!==null||_!==0)&&(l="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(h=this._variable.exec(t))&&(l="var",d=h[0]);break;case"@":this._previousMarker==="literal"&&(h=this._langcode.exec(t))?(l="langcode",d=h[1]):(h=this._keyword.exec(t))&&(l=h[0]);break;case".":if(t.length===1?i:t[1]<"0"||t[1]>"9"){l=".",_=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(t)||i&&(h=this._number.exec(`${t} `)))&&(l="literal",d=h[0],p=typeof h[1]=="string"?R.double:typeof h[2]=="string"?R.decimal:R.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(t))?l=h[0].toUpperCase():b=!0;break;case"f":case"t":(h=this._boolean.exec(t))?(l="literal",d=h[0],p=R.boolean):b=!0;break;case"a":(h=this._shortPredicates.exec(t))?(l="abbreviation",d="a"):b=!0;break;case"=":this._n3Mode&&t.length>1&&(l="abbreviation",t[1]!==">"?(_=1,d="="):(_=2,d=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(_=1,l=g);break;case"{":!this._lineMode&&t.length>=2&&(t[1]==="|"?(l="{|",_=2):(l=g,_=1));break;case"|":t.length>=2&&t[1]==="}"&&(l="|}",_=2);break;default:b=!0}if(b&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(h=this._prefix.exec(t))?(l="prefix",d=h[1]||""):((h=this._prefixed.exec(t))||i&&(h=this._prefixed.exec(`${t} `)))&&(l="prefixed",p=h[1]||"",d=this._unescape(h[2]))),this._previousMarker==="^^")switch(l){case"prefixed":l="type";break;case"IRI":l="typeIRI";break;default:l=""}if(!l)return i||!/^'''|^"""/.test(t)&&/\n|\r/.test(t)?r(this):this._input=t;const w=_||h[0].length,A=a(l,d,p,N,w);this.previousToken=A,this._previousMarker=l,t=t.substr(w,t.length)}function a(u,c,N,g,l){const d=t?s-t.length:s,p=d+l,h={type:u,value:c,prefix:N,line:g,start:d,end:p};return e(null,h),h}function r(u){e(u._syntaxError(/^\S*/.exec(t)[0]))}}_unescape(e){let i=!1;const t=e.replace(Q,(s,a,r,u)=>{if(typeof a=="string")return String.fromCharCode(Number.parseInt(a,16));if(typeof r=="string"){let c=Number.parseInt(r,16);return c<=65535?String.fromCharCode(Number.parseInt(r,16)):String.fromCharCode(55296+((c-=65536)>>10),56320+(c&1023))}return u in F?F[u]:(i=!0,"")});return i?null:t}_parseLiteral(e){if(e.length>=3){const i=e.match(/^(?:"""|"|'''|'|)/)[0],t=i.length;let s=Math.max(this._literalClosingPos,t);for(;(s=e.indexOf(i,s))>0;){let a=0;for(;e[s-a-1]==="\\";)a++;if(a%2===0){const r=e.substring(t,s),u=r.split(/\r\n|\r|\n/).length-1,c=s+t;if(t===1&&u!==0||t===3&&this._lineMode)break;return this._line+=u,{value:this._unescape(r),matchLength:c}}s++}this._literalClosingPos=e.length-t+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const i=new Error(`Unexpected "${e}" on line ${this._line}.`);return i.context={token:void 0,line:this._line,previousToken:this.previousToken},i}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,i){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof i=="function")U(()=>this._tokenizeToEnd(i,!0));else{const t=[];let s;if(this._tokenizeToEnd((a,r)=>a?s=a:t.push(r),!0),s)throw s;return t}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",t=>{this._input!==null&&t.length!==0&&(this._pendingBuffer&&(t=O.Buffer.concat([this._pendingBuffer,t]),this._pendingBuffer=null),t[t.length-1]&128?this._pendingBuffer=t:(typeof this._input>"u"?this._input=this._readStartingBom(typeof t=="string"?t:t.toString()):this._input+=t,this._tokenizeToEnd(i,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(i,!0)}),e.on("error",i)}}const{rdf:J,xsd:x}=f;let P,X=0;const K={namedNode:se,blankNode:re,variable:ue,literal:ae,defaultGraph:ne,quad:T,triple:T},W=K;class o{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof o?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}}class E extends o{get termType(){return"NamedNode"}}class y extends o{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let i=e.lastIndexOf('"')+1;return i<e.length&&e[i++]==="@"?e.substr(i).toLowerCase():""}get datatype(){return new E(this.datatypeString)}get datatypeString(){const e=this.id,i=e.lastIndexOf('"')+1,t=i<e.length?e[i]:"";return t==="^"?e.substr(i+2):t!=="@"?x.string:J.langString}equals(e){return e instanceof y?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class Y extends o{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class ee extends o{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}class te extends o{constructor(){return super(""),P||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}}P=new te;class ie extends o{constructor(e,i,t,s){super(""),this._subject=e,this._predicate=i,this._object=t,this._graph=s||P}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function se(n){return new E(n)}function re(n){return new Y(n||`n3-${X++}`)}function ae(n,e){if(typeof e=="string")return new y(`"${n}"@${e.toLowerCase()}`);let i=e?e.value:"";return i===""&&(typeof n=="boolean"?i=x.boolean:typeof n=="number"&&(Number.isFinite(n)?i=Number.isInteger(n)?x.integer:x.double:(i=x.double,Number.isNaN(n)||(n=n>0?"INF":"-INF")))),i===""||i===x.string?new y(`"${n}"`):new y(`"${n}"^^${i}`)}function ue(n){return new ee(n)}function ne(){return P}function T(n,e,i,t){return new ie(n,e,i,t)}let k=0;class C{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&L(this,e.factory);const i=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",t=/turtle/.test(i),s=/trig/.test(i),a=/triple/.test(i),r=/quad/.test(i),u=this._n3Mode=/n3/.test(i),c=a||r;(this._supportsNamedGraphs=!(t||u))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(t||s||a||u),this._supportsRDFStar=i===""||/star|\*$/.test(i),c&&(this._resolveRelativeIRI=N=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new V({lineMode:c,n3:u}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){k=0}_setBase(e){if(!e)this._base="",this._basePath="";else{const i=e.indexOf("#");i>=0&&(e=e.substr(0,i)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,i,t,s,a){const r=this._n3Mode;this._contextStack.push({type:e,subject:t,predicate:s,object:a,graph:i,inverse:r?this._inversePredicate:!1,blankPrefix:r?this._prefixes._:"",quantified:r?this._quantified:null}),r&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,i){const t=this._contextStack.pop();if(!t||t.type!==e)return this._error(`Unexpected ${i.type}`,i);this._subject=t.subject,this._predicate=t.predicate,this._object=t.object,this._graph=t.graph,this._n3Mode&&(this._inversePredicate=t.inverse,this._prefixes._=t.blankPrefix,this._quantified=t.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,i){let t;switch(e.type){case"IRI":case"typeIRI":const s=this._resolveIRI(e.value);if(s===null)return this._error("Invalid IRI",e);t=this._namedNode(s);break;case"type":case"prefixed":const a=this._prefixes[e.prefix];if(a===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);t=this._namedNode(a+e.value);break;case"blank":t=this._blankNode(this._prefixes[e.prefix]+e.value);break;case"var":t=this._variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!i&&this._n3Mode&&t.id in this._quantified&&(t=this._quantified[t.id]),t}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier=this._blankNode,this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier=this._variable,this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._literal(e.value,this._namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const i=e.type;switch(i){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${i}`,e):(this._subject=null,i==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._literal(e.value,this._namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);const i=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:i?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let i=null,t=null,s=this._readListItem;const a=this._subject,r=this._contextStack,u=r[r.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,t=this._blankNode(),this.RDF_FIRST,this._subject=i=this._blankNode()),s=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,t=this._blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),r.length!==0&&r[r.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(s=this._readPredicate,this._subject===this.RDF_NIL)return s}else if(s=this._getContextEndReader(),this._object===this.RDF_NIL)return s;t=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,s=this._readListItemDataTypeOrLang):(i=this._literal(e.value,this._namedNode(e.prefix)),s=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((i=this._readEntity(e))===void 0)return}if(t===null&&(this._subject=t=this._blankNode()),a===null?u.predicate===null?u.subject=t:u.object=t:this._emit(a,this.RDF_REST,t,this._graph),i!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,t,this.RDF_FIRST,i),this._subject=i,this._predicate=null,this._getPathReader(this._readListItem);this._emit(t,this.RDF_FIRST,i,this._graph)}return s}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let i=this._literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const t=this._readEntity(e);if(t===void 0)return;i=this._literal(this._literalValue,t),e=null;break;case"langcode":i=this._literal(this._literalValue,e.value),e=null;break}return{token:e,literal:i}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,i){const t=this._completeLiteral(e);if(t)return this._object=t.literal,i&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),t.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(t.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let i,t=this._graph;const s=this._subject,a=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,i=this._contextStack.length?this._readSubject:this._readInTopContext,a&&(this._inversePredicate=!1);break;case";":i=this._readPredicate;break;case",":i=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF* syntax",e);const r=this._predicate,u=this._object;this._subject=this._quad(s,r,u,this.DEFAULTGRAPH),i=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,i=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(t=this._readEntity(e))!==void 0){i=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(s!==null){const r=this._predicate,u=this._object;a?this._emit(u,r,s,t):this._emit(s,r,u,t)}return i}_readBlankNodePunctuation(e){let i;switch(e.type){case";":i=this._readPredicate;break;case",":i=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),i}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const i=this._readEntity(e);return this._prefixes[this._prefix]=i.value,this._prefixCallback(this._prefix,i),this._readDeclarationPunctuation}_readBaseIRI(e){const i=e.type==="IRI"&&this._resolveIRI(e.value);return i?(this._setBase(i),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let i;switch(e.type){case"IRI":case"prefixed":if((i=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,i,this.QUANTIFIERS_GRAPH)):this._quantified[i.id]=this._quantifier(this._blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const i=this._contextStack,t=i.length&&i[i.length-1];if(t&&t.type==="item"){const s=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,s,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let i,t;const s=this._blankNode();if((t=this._readEntity(e))!==void 0)return this._predicate===null?(i=this._subject,this._subject=s):(i=this._object,this._object=s),this._emit(i,t,s,this._graph),this._readPath}_readBackwardPath(e){const i=this._blankNode();let t,s;if((t=this._readEntity(e))!==void 0)return this._predicate===null?(s=this._subject,this._subject=i):(s=this._object,this._object=i),this._emit(i,t,s,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);const i=this._quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=i,this._readPredicate):(this._object=i,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,i,t,s){this._callback(null,this._quad(e,i,t,s||this.DEFAULTGRAPH))}_error(e,i){const t=new Error(`${e} on line ${i.line}.`);t.context={token:i,line:i.line,previousToken:this._lexer.previousToken},this._callback(t),this._callback=v}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const i=e.length;let t="",s=-1,a=-1,r=0,u="/";for(;s<i;){switch(u){case":":if(a<0&&e[++s]==="/"&&e[++s]==="/")for(;(a=s+1)<i&&e[a]!=="/";)s=a;break;case"?":case"#":s=i;break;case"/":if(e[s+1]===".")switch(u=e[++s+1],u){case"/":t+=e.substring(r,s-1),r=s+1;break;case void 0:case"?":case"#":return t+e.substring(r,s)+e.substr(s+1);case".":if(u=e[++s+1],u===void 0||u==="/"||u==="?"||u==="#"){if(t+=e.substring(r,s-2),(r=t.lastIndexOf("/"))>=a&&(t=t.substr(0,r)),u!=="/")return`${t}/${e.substr(s+1)}`;r=s+1}}}u=e[++s]}return t+e.substring(r)}parse(e,i,t){if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${k++}_`,this._prefixCallback=t||v,this._inversePredicate=!1,this._quantified=Object.create(null),!i){const s=[];let a;if(this._callback=(r,u)=>{r?a=r:u&&s.push(u)},this._lexer.tokenize(e).every(r=>this._readCallback=this._readCallback(r)),a)throw a;return s}this._callback=i,this._lexer.tokenize(e,(s,a)=>{s!==null?(this._callback(s),this._callback=v):this._readCallback&&(this._readCallback=this._readCallback(a))})}}function v(){}function L(n,e){const i=e.namedNode;n._namedNode=i,n._blankNode=e.blankNode,n._literal=e.literal,n._variable=e.variable,n._quad=e.quad,n.DEFAULTGRAPH=e.defaultGraph(),n.RDF_FIRST=i(f.rdf.first),n.RDF_REST=i(f.rdf.rest),n.RDF_NIL=i(f.rdf.nil),n.N3_FORALL=i(f.r.forAll),n.N3_FORSOME=i(f.r.forSome),n.ABBREVIATIONS={a:i(f.rdf.type),"=":i(f.owl.sameAs),">":i(f.log.implies)},n.QUANTIFIERS_GRAPH=i("urn:n3:quantifiers")}L(C.prototype,W);class he extends $.Transform{constructor(e){super({decodeStrings:!0}),this._readableState.objectMode=!0;const i=new C(e);let t,s;i.parse({on:(a,r)=>{switch(a){case"data":t=r;break;case"end":s=r;break}}},(a,r)=>{a&&this.emit("error",a)||r&&this.push(r)},(a,r)=>{this.emit("prefix",a,r)}),this._transform=(a,r,u)=>{t(a),u()},this._flush=a=>{s(),a()}}import(e){return e.on("data",i=>{this.write(i)}),e.on("end",()=>{this.end()}),e.on("error",i=>{this.emit("error",i)}),this}}class le{constructor(e,{baseIRI:i="",factory:t=q,...s}={}){const a={blankNode:t.blankNode.bind(t),defaultGraph:t.defaultGraph.bind(t),literal:t.literal.bind(t),namedNode:t.namedNode.bind(t),quad:t.quad.bind(t)},r=new he({baseIRI:i,factory:a,...s});return e.pipe(r),B(r)}}class fe extends D{constructor(e){super(le,e)}}export{fe as default};
