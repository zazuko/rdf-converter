import{S as Mt}from"./index-BOvYCoiN.js";import{O as Je,c as W,b as At,Q as Jt}from"./index-BXj-mBhB.js";import{r as Xt}from"./readable-BmS1kvD9.js";import{r as Ye,a as Wt}from"./index-DuuRCyoB.js";import{c as Yt}from"./canonicalize-Bd8h0v92.js";var Nt={},se={},{Buffer:z}=Je,A={},vt=A.LEFT_BRACE=1,_e=A.RIGHT_BRACE=2,Dt=A.LEFT_BRACKET=3,Xe=A.RIGHT_BRACKET=4,be=A.COLON=5,Re=A.COMMA=6,Lt=A.TRUE=7,Pt=A.FALSE=8,Vt=A.NULL=9,me=A.STRING=10,Ut=A.NUMBER=11,Z=A.START=17,jt=A.STOP=18,Ze=A.TRUE1=33,et=A.TRUE2=34,tt=A.TRUE3=35,rt=A.FALSE1=49,nt=A.FALSE2=50,it=A.FALSE3=51,at=A.FALSE4=52,st=A.NULL1=65,ot=A.NULL2=66,lt=A.NULL3=67,dt=A.NUMBER1=81,$e=A.NUMBER3=83,K=A.STRING1=97,ct=A.STRING2=98,ft=A.STRING3=99,qt=A.STRING4=100,zt=A.STRING5=101,ut=A.STRING6=102,ne=A.VALUE=113,Me=A.KEY=114,ge=A.OBJECT=129,pe=A.ARRAY=130,Qt=92,Zt=47,er=8,tr=12,rr=10,nr=13,ir=9,qe=64*1024;function we(l){return z.alloc?z.alloc(l):new z(l)}function Q(){this.tState=Z,this.value=void 0,this.string=void 0,this.stringBuffer=we(qe),this.stringBufferOffset=0,this.unicode=void 0,this.highSurrogate=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=ne,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:we(2),3:we(3),4:we(4)},this.offset=-1}Q.toknam=function(l){for(var e=Object.keys(A),r=0,d=e.length;r<d;r++){var s=e[r];if(A[s]===l)return s}return l&&"0x"+l.toString(16)};var B=Q.prototype;B.onError=function(l){throw l};B.charError=function(l,e){this.tState=jt,this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(l[e]))+" at position "+e+" in state "+Q.toknam(this.tState)))};B.appendStringChar=function(l){this.stringBufferOffset>=qe&&(this.string+=this.stringBuffer.toString("utf8"),this.stringBufferOffset=0),this.stringBuffer[this.stringBufferOffset++]=l};B.appendStringBuf=function(l,e,r){var d=l.length;typeof e=="number"&&(typeof r=="number"?r<0?d=l.length-e+r:d=r-e:d=l.length-e),d<0&&(d=0),this.stringBufferOffset+d>qe&&(this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0),l.copy(this.stringBuffer,this.stringBufferOffset,e,r),this.stringBufferOffset+=d};B.write=function(l){typeof l=="string"&&(l=new z(l));for(var e,r=0,d=l.length;r<d;r++)if(this.tState===Z){if(e=l[r],this.offset++,e===123)this.onToken(vt,"{");else if(e===125)this.onToken(_e,"}");else if(e===91)this.onToken(Dt,"[");else if(e===93)this.onToken(Xe,"]");else if(e===58)this.onToken(be,":");else if(e===44)this.onToken(Re,",");else if(e===116)this.tState=Ze;else if(e===102)this.tState=rt;else if(e===110)this.tState=st;else if(e===34)this.string="",this.stringBufferOffset=0,this.tState=K;else if(e===45)this.string="-",this.tState=dt;else if(e>=48&&e<64)this.string=String.fromCharCode(e),this.tState=$e;else if(!(e===32||e===9||e===10||e===13))return this.charError(l,r)}else if(this.tState===K)if(e=l[r],this.bytes_remaining>0){for(var s=0;s<this.bytes_remaining;s++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+s]=l[s];this.appendStringBuf(this.temp_buffs[this.bytes_in_sequence]),this.bytes_in_sequence=this.bytes_remaining=0,r=r+s-1}else if(this.bytes_remaining===0&&e>=128){if(e<=193||e>244)return this.onError(new Error("Invalid UTF-8 character at position "+r+" in state "+Q.toknam(this.tState)));if(e>=194&&e<=223&&(this.bytes_in_sequence=2),e>=224&&e<=239&&(this.bytes_in_sequence=3),e>=240&&e<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+r>l.length){for(var a=0;a<=l.length-1-r;a++)this.temp_buffs[this.bytes_in_sequence][a]=l[r+a];this.bytes_remaining=r+this.bytes_in_sequence-l.length,r=l.length-1}else this.appendStringBuf(l,r,r+this.bytes_in_sequence),r=r+this.bytes_in_sequence-1}else if(e===34)this.tState=Z,this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0,this.onToken(me,this.string),this.offset+=z.byteLength(this.string,"utf8")+1,this.string=void 0;else if(e===92)this.tState=ct;else if(e>=32)this.appendStringChar(e);else return this.charError(l,r);else if(this.tState===ct)if(e=l[r],e===34)this.appendStringChar(e),this.tState=K;else if(e===92)this.appendStringChar(Qt),this.tState=K;else if(e===47)this.appendStringChar(Zt),this.tState=K;else if(e===98)this.appendStringChar(er),this.tState=K;else if(e===102)this.appendStringChar(tr),this.tState=K;else if(e===110)this.appendStringChar(rr),this.tState=K;else if(e===114)this.appendStringChar(nr),this.tState=K;else if(e===116)this.appendStringChar(ir),this.tState=K;else if(e===117)this.unicode="",this.tState=ft;else return this.charError(l,r);else if(this.tState===ft||this.tState===qt||this.tState===zt||this.tState===ut)if(e=l[r],e>=48&&e<64||e>64&&e<=70||e>96&&e<=102){if(this.unicode+=String.fromCharCode(e),this.tState++===ut){var t=parseInt(this.unicode,16);this.unicode=void 0,this.highSurrogate!==void 0&&t>=56320&&t<57344?(this.appendStringBuf(new z(String.fromCharCode(this.highSurrogate,t))),this.highSurrogate=void 0):this.highSurrogate===void 0&&t>=55296&&t<56320?this.highSurrogate=t:(this.highSurrogate!==void 0&&(this.appendStringBuf(new z(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.appendStringBuf(new z(String.fromCharCode(t)))),this.tState=K}}else return this.charError(l,r);else if(this.tState===dt||this.tState===$e)switch(e=l[r],e){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 46:case 101:case 69:case 43:case 45:this.string+=String.fromCharCode(e),this.tState=$e;break;default:this.tState=Z;var n=this.numberReviver(this.string);if(n)return n;this.offset+=this.string.length-1,this.string=void 0,r--;break}else if(this.tState===Ze)if(l[r]===114)this.tState=et;else return this.charError(l,r);else if(this.tState===et)if(l[r]===117)this.tState=tt;else return this.charError(l,r);else if(this.tState===tt)if(l[r]===101)this.tState=Z,this.onToken(Lt,!0),this.offset+=3;else return this.charError(l,r);else if(this.tState===rt)if(l[r]===97)this.tState=nt;else return this.charError(l,r);else if(this.tState===nt)if(l[r]===108)this.tState=it;else return this.charError(l,r);else if(this.tState===it)if(l[r]===115)this.tState=at;else return this.charError(l,r);else if(this.tState===at)if(l[r]===101)this.tState=Z,this.onToken(Pt,!1),this.offset+=4;else return this.charError(l,r);else if(this.tState===st)if(l[r]===117)this.tState=ot;else return this.charError(l,r);else if(this.tState===ot)if(l[r]===108)this.tState=lt;else return this.charError(l,r);else if(this.tState===lt)if(l[r]===108)this.tState=Z,this.onToken(Vt,null),this.offset+=3;else return this.charError(l,r)};B.onToken=function(l,e){};B.parseError=function(l,e){this.tState=jt,this.onError(new Error("Unexpected "+Q.toknam(l)+(e?"("+JSON.stringify(e)+")":"")+" in state "+Q.toknam(this.state)))};B.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})};B.pop=function(){var l=this.value,e=this.stack.pop();this.value=e.value,this.key=e.key,this.mode=e.mode,this.emit(l),this.mode||(this.state=ne)};B.emit=function(l){this.mode&&(this.state=Re),this.onValue(l)};B.onValue=function(l){};B.onToken=function(l,e){if(this.state===ne)if(l===me||l===Ut||l===Lt||l===Pt||l===Vt)this.value&&(this.value[this.key]=e),this.emit(e);else if(l===vt)this.push(),this.value?this.value=this.value[this.key]={}:this.value={},this.key=void 0,this.state=Me,this.mode=ge;else if(l===Dt)this.push(),this.value?this.value=this.value[this.key]=[]:this.value=[],this.key=0,this.mode=pe,this.state=ne;else if(l===_e)if(this.mode===ge)this.pop();else return this.parseError(l,e);else if(l===Xe)if(this.mode===pe)this.pop();else return this.parseError(l,e);else return this.parseError(l,e);else if(this.state===Me)if(l===me)this.key=e,this.state=be;else if(l===_e)this.pop();else return this.parseError(l,e);else if(this.state===be)if(l===be)this.state=ne;else return this.parseError(l,e);else if(this.state===Re)if(l===Re)this.mode===pe?(this.key++,this.state=ne):this.mode===ge&&(this.state=Me);else if(l===Xe&&this.mode===pe||l===_e&&this.mode===ge)this.pop();else return this.parseError(l,e);else return this.parseError(l,e)};B.numberReviver=function(l){var e=Number(l);if(isNaN(e))return this.charError(buffer,i);l.match(/[0-9]+/)==l&&e.toString()!=l?this.onToken(me,l):this.onToken(Ut,e)};Q.C=A;var ar=Q,F={},Se={};(function(){(function(l){(function(e){var r={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function d(u){return u&&DataView.prototype.isPrototypeOf(u)}if(r.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(u){return u&&s.indexOf(Object.prototype.toString.call(u))>-1};function t(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function n(u){return typeof u!="string"&&(u=String(u)),u}function o(u){var p={next:function(){var O=u.shift();return{done:O===void 0,value:O}}};return r.iterable&&(p[Symbol.iterator]=function(){return p}),p}function c(u){this.map={},u instanceof c?u.forEach(function(p,O){this.append(O,p)},this):Array.isArray(u)?u.forEach(function(p){this.append(p[0],p[1])},this):u&&Object.getOwnPropertyNames(u).forEach(function(p){this.append(p,u[p])},this)}c.prototype.append=function(u,p){u=t(u),p=n(p);var O=this.map[u];this.map[u]=O?O+", "+p:p},c.prototype.delete=function(u){delete this.map[t(u)]},c.prototype.get=function(u){return u=t(u),this.has(u)?this.map[u]:null},c.prototype.has=function(u){return this.map.hasOwnProperty(t(u))},c.prototype.set=function(u,p){this.map[t(u)]=n(p)},c.prototype.forEach=function(u,p){for(var O in this.map)this.map.hasOwnProperty(O)&&u.call(p,this.map[O],O,this)},c.prototype.keys=function(){var u=[];return this.forEach(function(p,O){u.push(O)}),o(u)},c.prototype.values=function(){var u=[];return this.forEach(function(p){u.push(p)}),o(u)},c.prototype.entries=function(){var u=[];return this.forEach(function(p,O){u.push([O,p])}),o(u)},r.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);function f(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function E(u){return new Promise(function(p,O){u.onload=function(){p(u.result)},u.onerror=function(){O(u.error)}})}function h(u){var p=new FileReader,O=E(p);return p.readAsArrayBuffer(u),O}function y(u){var p=new FileReader,O=E(p);return p.readAsText(u),O}function _(u){for(var p=new Uint8Array(u),O=new Array(p.length),x=0;x<p.length;x++)O[x]=String.fromCharCode(p[x]);return O.join("")}function b(u){if(u.slice)return u.slice(0);var p=new Uint8Array(u.byteLength);return p.set(new Uint8Array(u)),p.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(u){this._bodyInit=u,u?typeof u=="string"?this._bodyText=u:r.blob&&Blob.prototype.isPrototypeOf(u)?this._bodyBlob=u:r.formData&&FormData.prototype.isPrototypeOf(u)?this._bodyFormData=u:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)?this._bodyText=u.toString():r.arrayBuffer&&r.blob&&d(u)?(this._bodyArrayBuffer=b(u.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(u)||a(u))?this._bodyArrayBuffer=b(u):this._bodyText=u=Object.prototype.toString.call(u):this._bodyText="",this.headers.get("content-type")||(typeof u=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var u=f(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var u=f(this);if(u)return u;if(this._bodyBlob)return y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(_(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(Y)}),this.json=function(){return this.text().then(JSON.parse)},this}var C=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function P(u){var p=u.toUpperCase();return C.indexOf(p)>-1?p:u}function N(u,p){p=p||{};var O=p.body;if(u instanceof N){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,p.headers||(this.headers=new c(u.headers)),this.method=u.method,this.mode=u.mode,this.signal=u.signal,!O&&u._bodyInit!=null&&(O=u._bodyInit,u.bodyUsed=!0)}else this.url=String(u);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new c(p.headers)),this.method=P(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&O)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(O)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function Y(u){var p=new FormData;return u.trim().split("&").forEach(function(O){if(O){var x=O.split("="),v=x.shift().replace(/\+/g," "),m=x.join("=").replace(/\+/g," ");p.append(decodeURIComponent(v),decodeURIComponent(m))}}),p}function w(u){var p=new c,O=u.replace(/\r?\n[\t ]+/g," ");return O.split(/\r?\n/).forEach(function(x){var v=x.split(":"),m=v.shift().trim();if(m){var j=v.join(":").trim();p.append(m,j)}}),p}R.call(N.prototype);function I(u,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new c(p.headers),this.url=p.url||"",this._initBody(u)}R.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},I.error=function(){var u=new I(null,{status:0,statusText:""});return u.type="error",u};var S=[301,302,303,307,308];I.redirect=function(u,p){if(S.indexOf(p)===-1)throw new RangeError("Invalid status code");return new I(null,{status:p,headers:{location:u}})},e.DOMException=l.DOMException;try{new e.DOMException}catch{e.DOMException=function(p,O){this.message=p,this.name=O;var x=Error(p);this.stack=x.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function D(u,p){return new Promise(function(O,x){var v=new N(u,p);if(v.signal&&v.signal.aborted)return x(new e.DOMException("Aborted","AbortError"));var m=new XMLHttpRequest;function j(){m.abort()}m.onload=function(){var U={status:m.status,statusText:m.statusText,headers:w(m.getAllResponseHeaders()||"")};U.url="responseURL"in m?m.responseURL:U.headers.get("X-Request-URL");var ke="response"in m?m.response:m.responseText;O(new I(ke,U))},m.onerror=function(){x(new TypeError("Network request failed"))},m.ontimeout=function(){x(new TypeError("Network request failed"))},m.onabort=function(){x(new e.DOMException("Aborted","AbortError"))},m.open(v.method,v.url,!0),v.credentials==="include"?m.withCredentials=!0:v.credentials==="omit"&&(m.withCredentials=!1),"responseType"in m&&r.blob&&(m.responseType="blob"),v.headers.forEach(function(U,ke){m.setRequestHeader(ke,U)}),v.signal&&(v.signal.addEventListener("abort",j),m.onreadystatechange=function(){m.readyState===4&&v.signal.removeEventListener("abort",j)}),m.send(typeof v._bodyInit>"u"?null:v._bodyInit)})}return D.polyfill=!0,l.fetch||(l.fetch=D,l.Headers=c,l.Request=N,l.Response=I),e.Headers=c,e.Request=N,e.Response=I,e.fetch=D,Object.defineProperty(e,"__esModule",{value:!0}),e})({})})(typeof self<"u"?self:W)})();var ie={};(function(l){Object.defineProperty(l,"__esModule",{value:!0}),l.ERROR_CODES=l.ErrorCoded=void 0;class e extends Error{constructor(d,s){super(d),this.code=s}}l.ErrorCoded=e,function(r){r.COLLIDING_KEYWORDS="colliding keywords",r.CONFLICTING_INDEXES="conflicting indexes",r.CYCLIC_IRI_MAPPING="cyclic IRI mapping",r.INVALID_ID_VALUE="invalid @id value",r.INVALID_INDEX_VALUE="invalid @index value",r.INVALID_NEST_VALUE="invalid @nest value",r.INVALID_PREFIX_VALUE="invalid @prefix value",r.INVALID_PROPAGATE_VALUE="invalid @propagate value",r.INVALID_REVERSE_VALUE="invalid @reverse value",r.INVALID_IMPORT_VALUE="invalid @import value",r.INVALID_VERSION_VALUE="invalid @version value",r.INVALID_BASE_IRI="invalid base IRI",r.INVALID_CONTAINER_MAPPING="invalid container mapping",r.INVALID_CONTEXT_ENTRY="invalid context entry",r.INVALID_CONTEXT_NULLIFICATION="invalid context nullification",r.INVALID_DEFAULT_LANGUAGE="invalid default language",r.INVALID_INCLUDED_VALUE="invalid @included value",r.INVALID_IRI_MAPPING="invalid IRI mapping",r.INVALID_JSON_LITERAL="invalid JSON literal",r.INVALID_KEYWORD_ALIAS="invalid keyword alias",r.INVALID_LANGUAGE_MAP_VALUE="invalid language map value",r.INVALID_LANGUAGE_MAPPING="invalid language mapping",r.INVALID_LANGUAGE_TAGGED_STRING="invalid language-tagged string",r.INVALID_LANGUAGE_TAGGED_VALUE="invalid language-tagged value",r.INVALID_LOCAL_CONTEXT="invalid local context",r.INVALID_REMOTE_CONTEXT="invalid remote context",r.INVALID_REVERSE_PROPERTY="invalid reverse property",r.INVALID_REVERSE_PROPERTY_MAP="invalid reverse property map",r.INVALID_REVERSE_PROPERTY_VALUE="invalid reverse property value",r.INVALID_SCOPED_CONTEXT="invalid scoped context",r.INVALID_SCRIPT_ELEMENT="invalid script element",r.INVALID_SET_OR_LIST_OBJECT="invalid set or list object",r.INVALID_TERM_DEFINITION="invalid term definition",r.INVALID_TYPE_MAPPING="invalid type mapping",r.INVALID_TYPE_VALUE="invalid type value",r.INVALID_TYPED_VALUE="invalid typed value",r.INVALID_VALUE_OBJECT="invalid value object",r.INVALID_VALUE_OBJECT_VALUE="invalid value object value",r.INVALID_VOCAB_MAPPING="invalid vocab mapping",r.IRI_CONFUSED_WITH_PREFIX="IRI confused with prefix",r.KEYWORD_REDEFINITION="keyword redefinition",r.LOADING_DOCUMENT_FAILED="loading document failed",r.LOADING_REMOTE_CONTEXT_FAILED="loading remote context failed",r.MULTIPLE_CONTEXT_LINK_HEADERS="multiple context link headers",r.PROCESSING_MODE_CONFLICT="processing mode conflict",r.PROTECTED_TERM_REDEFINITION="protected term redefinition",r.CONTEXT_OVERFLOW="context overflow",r.INVALID_BASE_DIRECTION="invalid base direction",r.RECURSIVE_CONTEXT_INCLUSION="recursive context inclusion",r.INVALID_STREAMING_KEY_ORDER="invalid streaming key order",r.INVALID_EMBEDDED_NODE="invalid embedded node",r.INVALID_ANNOTATION="invalid annotation"}(l.ERROR_CODES||(l.ERROR_CODES={}))})(ie);var ye={},sr=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,or=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,lr=/\s|\uFEFF|\xA0/,dr=/\r?\n[\x20\x09]+/g,cr=/[;,"]/,fr=/[;,"]|\s/,ur=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,M={IDLE:1,URI:2,ATTR:4};function ht(l){return l.replace(or,"")}function Oe(l){return lr.test(l)}function hr(l,e){for(;Oe(l[e]);)e++;return e}function Et(l){return fr.test(l)||!ur.test(l)}function Er(l,e){return Object.keys(l).length===Object.keys(e).length&&Object.keys(l).every(r=>r in e&&l[r]===e[r])}class V{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){for(var r=[],d=e.toLowerCase(),s=0;s<this.refs.length;s++)this.refs[s].rel.toLowerCase()===d&&r.push(this.refs[s]);return r}get(e,r){e=e.toLowerCase();for(var d=[],s=0;s<this.refs.length;s++)this.refs[s][e]===r&&d.push(this.refs[s]);return d}set(e){return this.refs.push(e),this}setUnique(e){return this.refs.some(r=>Er(r,e))||this.refs.push(e),this}has(e,r){e=e.toLowerCase();for(var d=0;d<this.refs.length;d++)if(this.refs[d][e]===r)return!0;return!1}parse(e,a){a=a||0,e=a?e.slice(a):e,e=ht(e).replace(dr,"");for(var d=M.IDLE,s=e.length,a=0,t=null;a<s;)if(d===M.IDLE){if(Oe(e[a])){a++;continue}else if(e[a]==="<"){t!=null&&(t.rel!=null?this.refs.push(...V.expandRelations(t)):this.refs.push(t));var n=e.indexOf(">",a);if(n===-1)throw new Error("Expected end of URI delimiter at offset "+a);t={uri:e.slice(a+1,n)},a=n,d=M.URI}else throw new Error('Unexpected character "'+e[a]+'" at offset '+a);a++}else if(d===M.URI)if(Oe(e[a])){a++;continue}else if(e[a]===";")d=M.ATTR,a++;else if(e[a]===",")d=M.IDLE,a++;else throw new Error('Unexpected character "'+e[a]+'" at offset '+a);else if(d===M.ATTR){if(e[a]===";"||Oe(e[a])){a++;continue}var n=e.indexOf("=",a);n===-1&&(n=e.indexOf(";",a)),n===-1&&(n=e.length);var o=ht(e.slice(a,n)).toLowerCase(),c="";if(a=n+1,a=hr(e,a),e[a]==='"')for(a++;a<s;){if(e[a]==='"'){a++;break}e[a]==="\\"&&a++,c+=e[a],a++}else{for(var n=a+1;!cr.test(e[n])&&n<s;)n++;c=e.slice(a,n),a=n}switch(t[o]&&V.isSingleOccurenceAttr(o)||(o[o.length-1]==="*"?t[o]=V.parseExtendedValue(c):(c=o==="type"?c.toLowerCase():c,t[o]!=null?Array.isArray(t[o])?t[o].push(c):t[o]=[t[o],c]:t[o]=c)),e[a]){case",":d=M.IDLE;break;case";":d=M.ATTR;break}a++}else throw new Error('Unknown parser state "'+d+'"');return t!=null&&(t.rel!=null?this.refs.push(...V.expandRelations(t)):this.refs.push(t)),t=null,this}toString(){for(var e=[],r="",d=null,s=0;s<this.refs.length;s++)d=this.refs[s],r=Object.keys(this.refs[s]).reduce(function(a,t){return t==="uri"?a:a+"; "+V.formatAttribute(t,d[t])},"<"+d.uri+">"),e.push(r);return e.join(", ")}}V.isCompatibleEncoding=function(l){return sr.test(l)};V.parse=function(l,e){return new V().parse(l,e)};V.isSingleOccurenceAttr=function(l){return l==="rel"||l==="type"||l==="media"||l==="title"||l==="title*"};V.isTokenAttr=function(l){return l==="rel"||l==="type"||l==="anchor"};V.escapeQuotes=function(l){return l.replace(/"/g,'\\"')};V.expandRelations=function(l){var e=l.rel.split(" ");return e.map(function(r){var d=Object.assign({},l);return d.rel=r,d})};V.parseExtendedValue=function(l){var e=/([^']+)?(?:'([^']*)')?(.+)/.exec(l);return{language:e[2].toLowerCase(),encoding:V.isCompatibleEncoding(e[1])?null:e[1].toLowerCase(),value:V.isCompatibleEncoding(e[1])?decodeURIComponent(e[3]):e[3]}};V.formatExtendedAttribute=function(l,e){var r=(e.encoding||"utf-8").toUpperCase(),d=e.language||"en",s="";return Je.Buffer.isBuffer(e.value)&&V.isCompatibleEncoding(r)?s=e.value.toString(r):Je.Buffer.isBuffer(e.value)?s=e.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):s=encodeURIComponent(e.value),l+"="+r+"'"+d+"'"+s};V.formatAttribute=function(l,e){return Array.isArray(e)?e.map(r=>V.formatAttribute(l,r)).join("; "):l[l.length-1]==="*"||typeof e!="string"?V.formatExtendedAttribute(l,e):(V.isTokenAttr(l)?e=Et(e)?'"'+V.escapeQuotes(e)+'"':V.escapeQuotes(e):Et(e)&&(e=encodeURIComponent(e),e=e.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),e='"'+e+'"'),l+"="+e)};var Ft=V;Object.defineProperty(ye,"__esModule",{value:!0});ye.FetchDocumentLoader=void 0;const yt=ie,yr=Ft,gr=Ye;class pr{constructor(e){this.fetcher=e}async load(e){const r=await(this.fetcher||fetch)(e,{headers:new Headers({accept:"application/ld+json"})});if(r.ok&&r.headers){let d=r.headers.get("Content-Type");if(d){const s=d.indexOf(";");s>0&&(d=d.substr(0,s))}if(d==="application/ld+json")return await r.json();if(r.headers.has("Link")){let s;if(r.headers.forEach((a,t)=>{if(t==="link"){const n=(0,yr.parse)(a);for(const o of n.get("type","application/ld+json"))if(o.rel==="alternate"){if(s)throw new Error("Multiple JSON-LD alternate links were found on "+e);s=(0,gr.resolve)(o.uri,e)}}}),s)return this.load(s)}throw new yt.ErrorCoded(`Unsupported JSON-LD media type ${d}`,yt.ERROR_CODES.LOADING_DOCUMENT_FAILED)}else throw new Error(r.statusText||`Status code: ${r.status}`)}}ye.FetchDocumentLoader=pr;var ze={},ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.Util=void 0;let H=class J{static isCompactIri(e){return e.indexOf(":")>0&&!(e&&e[0]==="#")}static getPrefix(e,r){if(e&&e[0]==="#")return null;const d=e.indexOf(":");if(d>=0){if(e.length>d+1&&e.charAt(d+1)==="/"&&e.charAt(d+2)==="/")return null;const s=e.substr(0,d);if(s==="_")return null;if(r[s])return s}return null}static getContextValueId(e){if(e===null||typeof e=="string")return e;const r=e["@id"];return r||null}static isSimpleTermDefinitionPrefix(e,r){return!J.isPotentialKeyword(e)&&(r.allowPrefixNonGenDelims||typeof e=="string"&&(e[0]==="_"||J.isPrefixIriEndingWithGenDelim(e)))}static isPotentialKeyword(e){return typeof e=="string"&&J.KEYWORD_REGEX.test(e)}static isPrefixIriEndingWithGenDelim(e){return J.ENDS_WITH_GEN_DELIM.test(e)}static isPrefixValue(e){return e&&(typeof e=="string"||e&&typeof e=="object")}static isValidIri(e){return!!(e&&J.IRI_REGEX.test(e))}static isValidIriWeak(e){return!!e&&e[0]!==":"&&J.IRI_REGEX_WEAK.test(e)}static isValidKeyword(e){return J.VALID_KEYWORDS[e]}static isTermProtected(e,r){const d=e[r];return typeof d!="string"&&d&&d["@protected"]}static hasProtectedTerms(e){for(const r of Object.keys(e))if(J.isTermProtected(e,r))return!0;return!1}static isReservedInternalKeyword(e){return e.startsWith("@__")}static deepEqual(e,r){const d=Object.keys(e),s=Object.keys(r);return d.length!==s.length?!1:d.every(a=>{const t=e[a],n=r[a];return t===n||t!==null&&n!==null&&typeof t=="object"&&typeof n=="object"&&this.deepEqual(t,n)})}};H.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`#]*(#[^#]*)?$/;H.IRI_REGEX_WEAK=/(?::[^:])|\//;H.KEYWORD_REGEX=/^@[a-z]+$/i;H.ENDS_WITH_GEN_DELIM=/[:/?#\[\]@]$/;H.REGEX_LANGUAGE_TAG=/^[a-zA-Z]+(-[a-zA-Z0-9]+)*$/;H.REGEX_DIRECTION_TAG=/^(ltr)|(rtl)$/;H.VALID_KEYWORDS={"@annotation":!0,"@base":!0,"@container":!0,"@context":!0,"@direction":!0,"@graph":!0,"@id":!0,"@import":!0,"@included":!0,"@index":!0,"@json":!0,"@language":!0,"@list":!0,"@nest":!0,"@none":!0,"@prefix":!0,"@propagate":!0,"@protected":!0,"@reverse":!0,"@set":!0,"@type":!0,"@value":!0,"@version":!0,"@vocab":!0};H.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language","@version","@direction"];H.ALIAS_DOMAIN_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value","@version"];H.ALIAS_RANGE_BLACKLIST=["@context","@preserve"];H.CONTAINERS=["@list","@set","@index","@language","@graph","@id","@type"];H.CONTAINERS_1_0=["@list","@set","@index"];ae.Util=H;(function(l){Object.defineProperty(l,"__esModule",{value:!0}),l.defaultExpandOptions=l.JsonLdContextNormalized=void 0;const e=Ye,r=ie,d=ae;class s{constructor(t){this.contextRaw=t}getContextRaw(){return this.contextRaw}expandTerm(t,n,o=l.defaultExpandOptions){const c=this.contextRaw[t];if(c===null||c&&c["@id"]===null)return null;let f=!0;if(c&&n){const R=d.Util.getContextValueId(c);if(R&&R!==t)if(typeof R!="string"||!d.Util.isValidIri(R)&&!d.Util.isValidKeyword(R))d.Util.isPotentialKeyword(R)||(f=!1);else return R}const E=d.Util.getPrefix(t,this.contextRaw),h=this.contextRaw["@vocab"],y=(!!h||h==="")&&h.indexOf(":")<0,_=this.contextRaw["@base"],b=d.Util.isPotentialKeyword(t);if(E){const R=this.contextRaw[E],C=d.Util.getContextValueId(R);if(C){if(typeof R=="string"||!o.allowPrefixForcing){if(!d.Util.isSimpleTermDefinitionPrefix(C,o))return t}else if(C[0]!=="_"&&!b&&!R["@prefix"]&&!(t in this.contextRaw))return t;return C+t.substr(E.length+1)}}else if(n&&(h||h===""||o.allowVocabRelativeToBase&&_&&y)&&!b&&!d.Util.isCompactIri(t))if(y){if(o.allowVocabRelativeToBase)return(h||_?(0,e.resolve)(h,_):"")+t;throw new r.ErrorCoded(`Relative vocab expansion for term '${t}' with vocab '${h}' is not allowed.`,r.ERROR_CODES.INVALID_VOCAB_MAPPING)}else return h+t;else if(!n&&_&&!b&&!d.Util.isCompactIri(t))return(0,e.resolve)(t,_);if(f)return t;throw new r.ErrorCoded(`Invalid IRI mapping found for context entry '${t}': '${JSON.stringify(c)}'`,r.ERROR_CODES.INVALID_IRI_MAPPING)}compactIri(t,n){if(n&&this.contextRaw["@vocab"]&&t.startsWith(this.contextRaw["@vocab"]))return t.substr(this.contextRaw["@vocab"].length);if(!n&&this.contextRaw["@base"]&&t.startsWith(this.contextRaw["@base"]))return t.substr(this.contextRaw["@base"].length);const o={prefix:"",suffix:t};for(const c in this.contextRaw){const f=this.contextRaw[c];if(f&&!d.Util.isPotentialKeyword(c)){const E=d.Util.getContextValueId(f);if(t.startsWith(E)){const h=t.substr(E.length);if(h)h.length<o.suffix.length&&(o.prefix=c,o.suffix=h);else if(n)return c}}}return o.prefix?o.prefix+":"+o.suffix:t}}l.JsonLdContextNormalized=s,l.defaultExpandOptions={allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}})(ze);Object.defineProperty(Se,"__esModule",{value:!0});Se.ContextParser=void 0;const gt=Ye,g=ie,wr=ye,G=ze,T=ae;class X{constructor(e){e=e||{},this.documentLoader=e.documentLoader||new wr.FetchDocumentLoader,this.documentCache={},this.validateContext=!e.skipValidation,this.expandContentTypeToBase=!!e.expandContentTypeToBase,this.remoteContextsDepthLimit=e.remoteContextsDepthLimit||32,this.redirectSchemaOrgHttps="redirectSchemaOrgHttps"in e?!!e.redirectSchemaOrgHttps:!0}static validateLanguage(e,r,d){if(typeof e!="string")throw new g.ErrorCoded(`The value of an '@language' must be a string, got '${JSON.stringify(e)}'`,d);if(!T.Util.REGEX_LANGUAGE_TAG.test(e)){if(r)throw new g.ErrorCoded(`The value of an '@language' must be a valid language tag, got '${JSON.stringify(e)}'`,d);return!1}return!0}static validateDirection(e,r){if(typeof e!="string")throw new g.ErrorCoded(`The value of an '@direction' must be a string, got '${JSON.stringify(e)}'`,g.ERROR_CODES.INVALID_BASE_DIRECTION);if(!T.Util.REGEX_DIRECTION_TAG.test(e)){if(r)throw new g.ErrorCoded(`The value of an '@direction' must be 'ltr' or 'rtl', got '${JSON.stringify(e)}'`,g.ERROR_CODES.INVALID_BASE_DIRECTION);return!1}return!0}idifyReverseTerms(e){for(const r of Object.keys(e)){let d=e[r];if(d&&typeof d=="object"&&d["@reverse"]&&!d["@id"]){if(typeof d["@reverse"]!="string"||T.Util.isValidKeyword(d["@reverse"]))throw new g.ErrorCoded(`Invalid @reverse value, must be absolute IRI or blank node: '${d["@reverse"]}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);d=e[r]=Object.assign(Object.assign({},d),{"@id":d["@reverse"]}),d["@id"]=d["@reverse"],T.Util.isPotentialKeyword(d["@reverse"])?delete d["@reverse"]:d["@reverse"]=!0}}return e}expandPrefixedTerms(e,r,d){const s=e.getContextRaw();for(const a of d||Object.keys(s))if(T.Util.EXPAND_KEYS_BLACKLIST.indexOf(a)<0&&!T.Util.isReservedInternalKeyword(a)){const t=s[a];if(T.Util.isPotentialKeyword(a)&&T.Util.ALIAS_DOMAIN_BLACKLIST.indexOf(a)>=0&&(a!=="@type"||typeof s[a]=="object"&&!(s[a]["@protected"]||s[a]["@container"]==="@set")))throw new g.ErrorCoded(`Keywords can not be aliased to something else.
Tried mapping ${a} to ${JSON.stringify(t)}`,g.ERROR_CODES.KEYWORD_REDEFINITION);if(T.Util.ALIAS_RANGE_BLACKLIST.indexOf(T.Util.getContextValueId(t))>=0)throw new g.ErrorCoded(`Aliasing to certain keywords is not allowed.
Tried mapping ${a} to ${JSON.stringify(t)}`,g.ERROR_CODES.INVALID_KEYWORD_ALIAS);if(t&&T.Util.isPotentialKeyword(T.Util.getContextValueId(t))&&t["@prefix"]===!0)throw new g.ErrorCoded(`Tried to use keyword aliases as prefix: '${a}': '${JSON.stringify(t)}'`,g.ERROR_CODES.INVALID_TERM_DEFINITION);for(;T.Util.isPrefixValue(s[a]);){const n=s[a];let o=!1;if(typeof n=="string")s[a]=e.expandTerm(n,!0),o=o||n!==s[a];else{const c=n["@id"],f=n["@type"],E=!("@prefix"in n)||T.Util.isValidIri(a);if("@id"in n)c!=null&&typeof c=="string"&&(s[a]=Object.assign(Object.assign({},s[a]),{"@id":e.expandTerm(c,!0)}),o=o||c!==s[a]["@id"]);else if(!T.Util.isPotentialKeyword(a)&&E){const h=e.expandTerm(a,!0);h!==a&&(s[a]=Object.assign(Object.assign({},s[a]),{"@id":h}),o=!0)}if(f&&typeof f=="string"&&f!=="@vocab"&&(!n["@container"]||!n["@container"]["@type"])&&E){let h=e.expandTerm(f,!0);r&&f===h&&(h=e.expandTerm(f,!1)),h!==f&&(o=!0,s[a]=Object.assign(Object.assign({},s[a]),{"@type":h}))}}if(!o)break}}}normalize(e,{processingMode:r,normalizeLanguageTags:d}){if(d||r===1)for(const s of Object.keys(e))if(s==="@language"&&typeof e[s]=="string")e[s]=e[s].toLowerCase();else{const a=e[s];if(a&&typeof a=="object"&&typeof a["@language"]=="string"){const t=a["@language"].toLowerCase();t!==a["@language"]&&(e[s]=Object.assign(Object.assign({},a),{"@language":t}))}}}containersToHash(e){for(const r of Object.keys(e)){const d=e[r];if(d&&typeof d=="object"){if(typeof d["@container"]=="string")e[r]=Object.assign(Object.assign({},d),{"@container":{[d["@container"]]:!0}});else if(Array.isArray(d["@container"])){const s={};for(const a of d["@container"])s[a]=!0;e[r]=Object.assign(Object.assign({},d),{"@container":s})}}}}applyScopedProtected(e,{processingMode:r},d){if(r&&r>=1.1&&e["@protected"]){for(const s of Object.keys(e))if(!T.Util.isReservedInternalKeyword(s)&&!T.Util.isPotentialKeyword(s)&&!T.Util.isTermProtected(e,s)){const a=e[s];a&&typeof a=="object"?"@protected"in e[s]||(e[s]=Object.assign(Object.assign({},e[s]),{"@protected":!0})):(e[s]={"@id":a,"@protected":!0},T.Util.isSimpleTermDefinitionPrefix(a,d)&&(e[s]=Object.assign(Object.assign({},e[s]),{"@prefix":!0})))}delete e["@protected"]}}validateKeywordRedefinitions(e,r,d,s){for(const a of s??Object.keys(r))if(T.Util.isTermProtected(e,a)&&(typeof r[a]=="string"?r[a]={"@id":r[a],"@protected":!0}:r[a]=Object.assign(Object.assign({},r[a]),{"@protected":!0}),!T.Util.deepEqual(e[a],r[a])))throw new g.ErrorCoded(`Attempted to override the protected keyword ${a} from ${JSON.stringify(T.Util.getContextValueId(e[a]))} to ${JSON.stringify(T.Util.getContextValueId(r[a]))}`,g.ERROR_CODES.PROTECTED_TERM_REDEFINITION)}validate(e,{processingMode:r}){for(const d of Object.keys(e)){if(T.Util.isReservedInternalKeyword(d))continue;if(d==="")throw new g.ErrorCoded(`The empty term is not allowed, got: '${d}': '${JSON.stringify(e[d])}'`,g.ERROR_CODES.INVALID_TERM_DEFINITION);const s=e[d],a=typeof s;if(T.Util.isPotentialKeyword(d)){switch(d.substr(1)){case"vocab":if(s!==null&&a!=="string")throw new g.ErrorCoded(`Found an invalid @vocab IRI: ${s}`,g.ERROR_CODES.INVALID_VOCAB_MAPPING);break;case"base":if(s!==null&&a!=="string")throw new g.ErrorCoded(`Found an invalid @base IRI: ${e[d]}`,g.ERROR_CODES.INVALID_BASE_IRI);break;case"language":s!==null&&X.validateLanguage(s,!0,g.ERROR_CODES.INVALID_DEFAULT_LANGUAGE);break;case"version":if(s!==null&&a!=="number")throw new g.ErrorCoded(`Found an invalid @version number: ${s}`,g.ERROR_CODES.INVALID_VERSION_VALUE);break;case"direction":s!==null&&X.validateDirection(s,!0);break;case"propagate":if(r===1)throw new g.ErrorCoded(`Found an illegal @propagate keyword: ${s}`,g.ERROR_CODES.INVALID_CONTEXT_ENTRY);if(s!==null&&a!=="boolean")throw new g.ErrorCoded(`Found an invalid @propagate value: ${s}`,g.ERROR_CODES.INVALID_PROPAGATE_VALUE);break}if(T.Util.isValidKeyword(d)&&T.Util.isValidKeyword(T.Util.getContextValueId(s)))throw new g.ErrorCoded(`Illegal keyword alias in term value, found: '${d}': '${T.Util.getContextValueId(s)}'`,g.ERROR_CODES.KEYWORD_REDEFINITION);continue}if(s!==null)switch(a){case"string":if(T.Util.getPrefix(s,e)===d)throw new g.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.CYCLIC_IRI_MAPPING);if(T.Util.isValidIriWeak(d)){if(s==="@type")throw new g.ErrorCoded(`IRIs can not be mapped to @type, found: '${d}': '${s}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);if(T.Util.isValidIri(s)&&s!==new G.JsonLdContextNormalized(e).expandTerm(d))throw new g.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${d}': '${s}'`,g.ERROR_CODES.INVALID_IRI_MAPPING)}break;case"object":if(!T.Util.isCompactIri(d)&&!("@id"in s)&&(s["@type"]==="@id"?!e["@base"]:!e["@vocab"]))throw new g.ErrorCoded(`Missing @id in context entry: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);for(const t of Object.keys(s)){const n=s[t];if(n)switch(t){case"@id":if(T.Util.isValidKeyword(n)&&n!=="@type"&&n!=="@id"&&n!=="@graph"&&n!=="@nest")throw new g.ErrorCoded(`Illegal keyword alias in term value, found: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);if(T.Util.isValidIriWeak(d)){if(n==="@type")throw new g.ErrorCoded(`IRIs can not be mapped to @type, found: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);if(T.Util.isValidIri(n)&&n!==new G.JsonLdContextNormalized(e).expandTerm(d))throw new g.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_IRI_MAPPING)}if(typeof n!="string")throw new g.ErrorCoded(`Detected non-string @id in context entry: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_IRI_MAPPING);if(T.Util.getPrefix(n,e)===d)throw new g.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.CYCLIC_IRI_MAPPING);break;case"@type":if(s["@container"]==="@type"&&n!=="@id"&&n!=="@vocab")throw new g.ErrorCoded(`@container: @type only allows @type: @id or @vocab, but got: '${d}': '${n}'`,g.ERROR_CODES.INVALID_TYPE_MAPPING);if(typeof n!="string")throw new g.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(a)}'`,g.ERROR_CODES.INVALID_TYPE_MAPPING);if(n!=="@id"&&n!=="@vocab"&&(r===1||n!=="@json")&&(r===1||n!=="@none")&&(n[0]==="_"||!T.Util.isValidIri(n)))throw new g.ErrorCoded(`A context @type must be an absolute IRI, found: '${d}': '${n}'`,g.ERROR_CODES.INVALID_TYPE_MAPPING);break;case"@reverse":if(typeof n=="string"&&s["@id"]&&s["@id"]!==n)throw new g.ErrorCoded(`Found non-matching @id and @reverse term values in '${d}':'${n}' and '${s["@id"]}'`,g.ERROR_CODES.INVALID_REVERSE_PROPERTY);if("@nest"in s)throw new g.ErrorCoded(`@nest is not allowed in the reverse property '${d}'`,g.ERROR_CODES.INVALID_REVERSE_PROPERTY);break;case"@container":if(r===1&&(Object.keys(n).length>1||T.Util.CONTAINERS_1_0.indexOf(Object.keys(n)[0])<0))throw new g.ErrorCoded(`Invalid term @container for '${d}' ('${Object.keys(n)}') in 1.0, must be only one of ${T.Util.CONTAINERS_1_0.join(", ")}`,g.ERROR_CODES.INVALID_CONTAINER_MAPPING);for(const o of Object.keys(n)){if(o==="@list"&&s["@reverse"])throw new g.ErrorCoded(`Term value can not be @container: @list and @reverse at the same time on '${d}'`,g.ERROR_CODES.INVALID_REVERSE_PROPERTY);if(T.Util.CONTAINERS.indexOf(o)<0)throw new g.ErrorCoded(`Invalid term @container for '${d}' ('${o}'), must be one of ${T.Util.CONTAINERS.join(", ")}`,g.ERROR_CODES.INVALID_CONTAINER_MAPPING)}break;case"@language":X.validateLanguage(n,!0,g.ERROR_CODES.INVALID_LANGUAGE_MAPPING);break;case"@direction":X.validateDirection(n,!0);break;case"@prefix":if(n!==null&&typeof n!="boolean")throw new g.ErrorCoded(`Found an invalid term @prefix boolean in: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_PREFIX_VALUE);if(!("@id"in s)&&!T.Util.isValidIri(d))throw new g.ErrorCoded(`Invalid @prefix definition for '${d}' ('${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@index":if(r===1||!s["@container"]||!s["@container"]["@index"])throw new g.ErrorCoded(`Attempt to add illegal key to value object: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@nest":if(T.Util.isPotentialKeyword(n)&&n!=="@nest")throw new g.ErrorCoded(`Found an invalid term @nest value in: '${d}': '${JSON.stringify(s)}'`,g.ERROR_CODES.INVALID_NEST_VALUE)}}break;default:throw new g.ErrorCoded(`Found an invalid term value: '${d}': '${s}'`,g.ERROR_CODES.INVALID_TERM_DEFINITION)}}}applyBaseEntry(e,r,d){return typeof e=="string"||(d&&!("@base"in e)&&r.parentContext&&typeof r.parentContext=="object"&&"@base"in r.parentContext&&(e["@base"]=r.parentContext["@base"],r.parentContext["@__baseDocument"]&&(e["@__baseDocument"]=!0)),r.baseIRI&&!r.external&&("@base"in e?e["@base"]!==null&&typeof e["@base"]=="string"&&!T.Util.isValidIri(e["@base"])&&(e["@base"]=(0,gt.resolve)(e["@base"],r.parentContext&&r.parentContext["@base"]||r.baseIRI)):(e["@base"]=r.baseIRI,e["@__baseDocument"]=!0))),e}normalizeContextIri(e,r){if(!T.Util.isValidIri(e))try{e=(0,gt.resolve)(e,r)}catch{throw new Error(`Invalid context IRI: ${e}`)}return this.redirectSchemaOrgHttps&&e.startsWith("http://schema.org")&&(e="https://schema.org/"),e}async parseInnerContexts(e,r,d){for(const s of d??Object.keys(e)){const a=e[s];if(a&&typeof a=="object"&&"@context"in a&&a["@context"]!==null&&!r.ignoreScopedContexts){if(this.validateContext)try{const t=Object.assign(Object.assign({},e),{[s]:Object.assign({},e[s])});delete t[s]["@context"],await this.parse(a["@context"],Object.assign(Object.assign({},r),{external:!1,parentContext:t,ignoreProtection:!0,ignoreRemoteScopedContexts:!0,ignoreScopedContexts:!0}))}catch(t){throw new g.ErrorCoded(t.message,g.ERROR_CODES.INVALID_SCOPED_CONTEXT)}e[s]=Object.assign(Object.assign({},a),{"@context":(await this.parse(a["@context"],Object.assign(Object.assign({},r),{external:!1,minimalProcessing:!0,ignoreRemoteScopedContexts:!0,parentContext:e}))).getContextRaw()})}}return e}async parse(e,r={},d={}){const{baseIRI:s,parentContext:a,external:t,processingMode:n=X.DEFAULT_PROCESSING_MODE,normalizeLanguageTags:o,ignoreProtection:c,minimalProcessing:f}=r,E=r.remoteContexts||{};if(Object.keys(E).length>=this.remoteContextsDepthLimit)throw new g.ErrorCoded("Detected an overflow in remote context inclusions: "+Object.keys(E),g.ERROR_CODES.CONTEXT_OVERFLOW);if(e==null){if(!c&&a&&T.Util.hasProtectedTerms(a))throw new g.ErrorCoded("Illegal context nullification when terms are protected",g.ERROR_CODES.INVALID_CONTEXT_NULLIFICATION);return new G.JsonLdContextNormalized(this.applyBaseEntry({},r,!1))}else if(typeof e=="string"){const h=this.normalizeContextIri(e,s),y=this.getOverriddenLoad(h,r);if(y)return new G.JsonLdContextNormalized(y);const _=await this.parse(await this.load(h),Object.assign(Object.assign({},r),{baseIRI:h,external:!0,remoteContexts:Object.assign(Object.assign({},E),{[h]:!0})}));return this.applyBaseEntry(_.getContextRaw(),r,!0),_}else if(Array.isArray(e)){const h=[],y=await Promise.all(e.map((b,R)=>{if(typeof b=="string"){const C=this.normalizeContextIri(b,s);h[R]=C;const P=this.getOverriddenLoad(C,r);return P||this.load(C)}else return b}));if(f)return new G.JsonLdContextNormalized(y);const _=await y.reduce((b,R,C)=>b.then(P=>this.parse(R,Object.assign(Object.assign({},r),{baseIRI:h[C]||r.baseIRI,external:!!h[C]||r.external,parentContext:P.getContextRaw(),remoteContexts:h[C]?Object.assign(Object.assign({},E),{[h[C]]:!0}):E}),{skipValidation:C<y.length-1})),Promise.resolve(new G.JsonLdContextNormalized(a||{})));return this.applyBaseEntry(_.getContextRaw(),r,!0),_}else if(typeof e=="object"){if("@context"in e)return await this.parse(e["@context"],r);if(e=Object.assign({},e),t&&delete e["@base"],this.applyBaseEntry(e,r,!0),this.containersToHash(e),f)return new G.JsonLdContextNormalized(e);let h={};if("@import"in e)if(n>=1.1){if(typeof e["@import"]!="string")throw new g.ErrorCoded("An @import value must be a string, but got "+typeof e["@import"],g.ERROR_CODES.INVALID_IMPORT_VALUE);h=await this.loadImportContext(this.normalizeContextIri(e["@import"],s)),delete e["@import"]}else throw new g.ErrorCoded("Context importing is not supported in JSON-LD 1.0",g.ERROR_CODES.INVALID_CONTEXT_ENTRY);this.applyScopedProtected(h,{processingMode:n},G.defaultExpandOptions);const y=Object.assign(h,e);this.idifyReverseTerms(y),this.normalize(y,{processingMode:n,normalizeLanguageTags:o}),this.applyScopedProtected(y,{processingMode:n},G.defaultExpandOptions);const _=Object.keys(y),b=[];if(typeof a=="object")for(const C in a)C in y?b.push(C):y[C]=a[C];await this.parseInnerContexts(y,r,_);const R=new G.JsonLdContextNormalized(y);return(y&&y["@version"]||X.DEFAULT_PROCESSING_MODE)>=1.1&&(e["@vocab"]&&typeof e["@vocab"]=="string"||e["@vocab"]==="")&&(a&&"@vocab"in a&&e["@vocab"].indexOf(":")<0?y["@vocab"]=a["@vocab"]+e["@vocab"]:(T.Util.isCompactIri(e["@vocab"])||e["@vocab"]in y)&&(y["@vocab"]=R.expandTerm(e["@vocab"],!0))),this.expandPrefixedTerms(R,this.expandContentTypeToBase,_),!c&&a&&n>=1.1&&this.validateKeywordRedefinitions(a,y,G.defaultExpandOptions,b),this.validateContext&&!d.skipValidation&&this.validate(y,{processingMode:n}),R}else throw new g.ErrorCoded(`Tried parsing a context that is not a string, array or object, but got ${e}`,g.ERROR_CODES.INVALID_LOCAL_CONTEXT)}async load(e){const r=this.documentCache[e];if(r)return r;let d;try{d=await this.documentLoader.load(e)}catch(s){throw new g.ErrorCoded(`Failed to load remote context ${e}: ${s.message}`,g.ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED)}if(!("@context"in d))throw new g.ErrorCoded(`Missing @context in remote context at ${e}`,g.ERROR_CODES.INVALID_REMOTE_CONTEXT);return this.documentCache[e]=d["@context"]}getOverriddenLoad(e,r){if(e in(r.remoteContexts||{})){if(r.ignoreRemoteScopedContexts)return e;throw new g.ErrorCoded("Detected a cyclic context inclusion of "+e,g.ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION)}return null}async loadImportContext(e){let r=await this.load(e);if(typeof r!="object"||Array.isArray(r))throw new g.ErrorCoded("An imported context must be a single object: "+e,g.ERROR_CODES.INVALID_REMOTE_CONTEXT);if("@import"in r)throw new g.ErrorCoded("An imported context can not import another context: "+e,g.ERROR_CODES.INVALID_CONTEXT_ENTRY);return r=Object.assign({},r),this.containersToHash(r),r}}X.DEFAULT_PROCESSING_MODE=1.1;Se.ContextParser=X;var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});(function(l){var e=W&&W.__createBinding||(Object.create?function(d,s,a,t){t===void 0&&(t=a);var n=Object.getOwnPropertyDescriptor(s,a);(!n||("get"in n?!s.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(d,t,n)}:function(d,s,a,t){t===void 0&&(t=a),d[t]=s[a]}),r=W&&W.__exportStar||function(d,s){for(var a in d)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&e(s,d,a)};Object.defineProperty(l,"__esModule",{value:!0}),r(Se,l),r(ie,l),r(ye,l),r(Bt,l),r(Ht,l),r(ze,l),r(ae,l)})(F);var Te={},oe={},le={},xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.ContainerHandlerIdentifier=void 0;class Ir{canCombineWithGraph(){return!0}async handle(e,r,d,s,a,t){let n;if(r.emittedStack[t+1]&&r.idStack[t+1])n=r.idStack[t+1][0];else{const f=await d.getContainerKey(s[t],s,t)!==null?await d.resourceToTerm(await r.getContext(s),s[t]):d.dataFactory.blankNode();if(!f){r.emittedStack[t]=!1;return}n=f,r.idStack[t+1]=[n]}let o=r.idStack[t];o||(o=r.idStack[t]=[]),o.some(c=>c.equals(n))||o.push(n),await r.handlePendingContainerFlushBuffers()||(r.emittedStack[t]=!1)}}xe.ContainerHandlerIdentifier=Ir;var de={},ce={},pt;function Ae(){if(pt)return ce;pt=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.EntryHandlerPredicate=void 0;const l=F,e=ee();let r=class Kt{static async handlePredicateObject(s,a,t,n,o,c,f,E,h){const y=await a.getPropertiesDepth(t,n),_=await a.getDepthOffsetGraph(n,t),b=n-_,R=s.idStack[y];if(R&&!h)for(const C of R)if(_>=0){const N=s.idStack[b-1];if(N)for(const Y of N)a.emitQuadChecked(n,C,o,c,Y,f,E);else f?(a.validateReverseSubject(c),s.getUnidentifiedGraphBufferSafe(b-1).push({subject:c,predicate:o,object:C,isEmbedded:E})):s.getUnidentifiedGraphBufferSafe(b-1).push({subject:C,predicate:o,object:c,isEmbedded:E})}else{const N=await a.getGraphContainerValue(t,y);a.emitQuadChecked(n,C,o,c,N,f,E)}else if(f&&a.validateReverseSubject(c),h){if(s.rdfstar){s.idStack[n]&&s.emitError(new l.ErrorCoded(`Found an illegal @id inside an annotation: ${s.idStack[n][0].value}`,l.ERROR_CODES.INVALID_ANNOTATION));for(let N=0;N<n;N++)await a.unaliasKeyword(t[N],t,N)==="@id"&&s.emitError(new l.ErrorCoded("Found an illegal annotation inside an embedded node",l.ERROR_CODES.INVALID_ANNOTATION));const C=s.getAnnotationsBufferSafe(y),P={predicate:o,object:c,reverse:f,nestedAnnotations:[],depth:y};C.push(P);for(let N=C.length-2;N>=0;N--){const Y=C[N];Y.depth>y&&(P.nestedAnnotations.push(Y),C.splice(N,1))}}}else s.getUnidentifiedValueBufferSafe(y).push({predicate:o,object:c,reverse:f,isEmbedded:E})}isPropertyHandler(){return!0}isStackProcessor(){return!0}async validate(s,a,t,n,o){const c=t[n];if(c){const f=await s.getContext(t);if(!s.jsonLiteralStack[n]&&await a.predicateToTerm(f,t[n]))return e.Util.getContextValueType(f,c)==="@json"&&(s.jsonLiteralStack[n+1]=!0),!0}return!1}async test(s,a,t,n,o){return n[o]}async handle(s,a,t,n,o,c,f){const E=n[c],h=await s.getContext(n),y=await a.predicateToTerm(h,t);if(y){const _=await a.valueToTerm(h,t,o,c,n);if(_.length)for(let b of _){let R=await a.unaliasKeywordParent(n,c);const C=e.Util.isPropertyReverse(h,E,R);let P=0;for(;R==="@reverse"||typeof R=="number";)typeof R=="number"?P++:c--,R=await a.unaliasKeywordParent(n,c-P);const N=e.Util.isPropertyInEmbeddedNode(R);a.validateReverseInEmbeddedNode(t,C,N);const Y=e.Util.isPropertyInAnnotationObject(R);if(o){const w="@list"in e.Util.getContextValueContainer(h,t);if(w||o["@list"]){if((w&&!Array.isArray(o)&&!o["@list"]||o["@list"]&&!Array.isArray(o["@list"]))&&b!==a.rdfNil){const I=a.dataFactory.blankNode();s.emitQuad(c,a.dataFactory.quad(I,a.rdfRest,a.rdfNil,a.getDefaultGraph())),s.emitQuad(c,a.dataFactory.quad(I,a.rdfFirst,b,a.getDefaultGraph())),b=I}if(C&&!s.allowSubjectList)throw new l.ErrorCoded(`Found illegal list value in subject position at ${t}`,l.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}}await Kt.handlePredicateObject(s,a,n,c,y,b,C,N,Y)}}}};return ce.EntryHandlerPredicate=r,ce}var wt;function Cr(){if(wt)return de;wt=1,Object.defineProperty(de,"__esModule",{value:!0}),de.ContainerHandlerIndex=void 0;const l=F,e=Ae(),r=ee();let d=class{canCombineWithGraph(){return!0}async handle(a,t,n,o,c,f){if(!Array.isArray(c)){const E="@graph"in a,h=await t.getContext(o),y=o[f-1],_=r.Util.getContextValueIndex(h,y);if(_){if(l.Util.isPotentialKeyword(_))throw new l.ErrorCoded(`Keywords can not be used as @index value, got: ${_}`,l.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof _!="string")throw new l.ErrorCoded(`@index values must be strings, got: ${_}`,l.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof c!="object"){if(r.Util.getContextValueType(h,y)!=="@id")throw new l.ErrorCoded(`Property-based index containers require nodes as values or strings with @type: @id, but got: ${c}`,l.ERROR_CODES.INVALID_VALUE_OBJECT);const C=n.resourceToTerm(h,c);C&&(t.idStack[f+1]=[C])}const R=n.createVocabOrBaseTerm(h,_);if(R){const C=await n.valueToTerm(h,_,await n.getContainerKey(o[f],o,f),f,o);if(E){const P=await n.getGraphContainerValue(o,f+1);for(const N of C)t.emitQuad(f,n.dataFactory.quad(P,R,N,n.getDefaultGraph()))}else for(const P of C)await e.EntryHandlerPredicate.handlePredicateObject(t,n,o,f+1,R,P,!1,!1,!1)}}const b=E?2:1;await t.newOnValueJob(o.slice(0,o.length-b),c,f-b,!0),await t.handlePendingContainerFlushBuffers()}t.emittedStack[f]=!1}};return de.ContainerHandlerIndex=d,de}var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.ContainerHandlerLanguage=void 0;const It=F;class _r{canCombineWithGraph(){return!1}async handle(e,r,d,s,a,t){const n=await d.getContainerKey(s[t],s,t);if(Array.isArray(a))a=a.map(o=>({"@value":o,"@language":n}));else{if(typeof a!="string")throw new It.ErrorCoded(`Got invalid language map value, got '${JSON.stringify(a)}', but expected string`,It.ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE);a={"@value":a,"@language":n}}await r.newOnValueJob(s.slice(0,s.length-1),a,t-1,!0),r.emittedStack[t]=!1}}Ne.ContainerHandlerLanguage=_r;var fe={},Ct;function br(){if(Ct)return fe;Ct=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.ContainerHandlerType=void 0;const l=Ae(),e=ee();let r=class{canCombineWithGraph(){return!1}async handle(s,a,t,n,o,c){if(!Array.isArray(o)){if(typeof o=="string"){const h=await a.getContext(n),_=e.Util.getContextValueType(h,n[c-1])==="@vocab"?await t.createVocabOrBaseTerm(h,o):await t.resourceToTerm(h,o);if(_){const b={"@id":_.termType==="NamedNode"?_.value:o};await a.newOnValueJob(n.slice(0,n.length-1),b,c-1,!0),a.idStack[c+1]=[_]}}else{const h=!!a.idStack[c+1];h||delete a.idStack[c],await a.newOnValueJob(n.slice(0,n.length-1),o,c-1,!0),h||(a.idStack[c+1]=a.idStack[c])}const f=await t.getContainerKey(n[c],n,c),E=f!==null?t.createVocabOrBaseTerm(await a.getContext(n),f):null;E&&await l.EntryHandlerPredicate.handlePredicateObject(a,t,n,c+1,t.rdfType,E,!1,!1,!1),await a.handlePendingContainerFlushBuffers()}a.emittedStack[c]=!1}};return fe.ContainerHandlerType=r,fe}var _t;function Gt(){if(_t)return le;_t=1,Object.defineProperty(le,"__esModule",{value:!0}),le.EntryHandlerContainer=void 0;const l=xe,e=Cr(),r=Ne,d=br(),s=ee();let a=class q{static isSimpleGraphContainer(n){return"@graph"in n&&("@set"in n&&Object.keys(n).length===2||Object.keys(n).length===1)}static isComplexGraphContainer(n){return"@graph"in n&&("@set"in n&&Object.keys(n).length>2||!("@set"in n)&&Object.keys(n).length>1)}static getContainerGraphIndex(n,o,c){let f=q.isSimpleGraphContainer(n),E="";for(let h=o;h<c.length;h++)(!f||typeof c[h]=="number")&&(E+=":"+c[h]),!f&&typeof c[h]!="number"&&(f=!0);return E}static async getContainerHandler(n,o,c){const f={containers:{"@set":!0},depth:c,fallback:!0};let E=!1;const h=await n.getContext(o,2);for(let y=c-1;y>=0;y--)if(typeof o[y]!="number"){const _=s.Util.getContextValue(h,"@container",o[y],!1);if(_&&q.isSimpleGraphContainer(_))return{containers:_,depth:y+1,fallback:!1};const b=s.Util.getContextValue(h,"@container",o[y-1],!1);if(b){const R="@graph"in b;for(const C in q.CONTAINER_HANDLERS)if(b[C])return R?q.CONTAINER_HANDLERS[C].canCombineWithGraph()?{containers:b,depth:y,fallback:!1}:f:E?f:{containers:b,depth:y,fallback:!1};return f}else{if(E)return f;E=!0}}return f}static async isBufferableContainerHandler(n,o,c){const f=await q.getContainerHandler(n,o,c);return!f.fallback&&!("@graph"in f.containers)}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(n,o,c,f,E){return!!await this.test(n,o,null,c,f)}async test(n,o,c,f,E){const h=s.Util.getContextValueContainer(await n.getContext(f,2),f[E-1]);for(const y in q.CONTAINER_HANDLERS)if(h[y])return{containers:h,handler:q.CONTAINER_HANDLERS[y]};return null}async handle(n,o,c,f,E,h,y){return y.handler.handle(y.containers,n,o,f,E,h)}};return a.CONTAINER_HANDLERS={"@id":new l.ContainerHandlerIdentifier,"@index":new e.ContainerHandlerIndex,"@language":new r.ContainerHandlerLanguage,"@type":new d.ContainerHandlerType},le.EntryHandlerContainer=a,le}var bt;function ee(){if(bt)return oe;bt=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.Util=void 0;const l=F,e=Wt,r=Gt(),d=Yt;let s=class L{constructor(t){this.parsingContext=t.parsingContext,this.dataFactory=t.dataFactory||new e.DataFactory,this.rdfFirst=this.dataFactory.namedNode(L.RDF+"first"),this.rdfRest=this.dataFactory.namedNode(L.RDF+"rest"),this.rdfNil=this.dataFactory.namedNode(L.RDF+"nil"),this.rdfType=this.dataFactory.namedNode(L.RDF+"type"),this.rdfJson=this.dataFactory.namedNode(L.RDF+"JSON")}static getContextValue(t,n,o,c){const f=t.getContextRaw()[o];if(!f)return c;const E=f[n];return E===void 0?c:E}static getContextValueContainer(t,n){return L.getContextValue(t,"@container",n,{"@set":!0})}static getContextValueType(t,n){const o=L.getContextValue(t,"@type",n,null);return o==="@none"?null:o}static getContextValueLanguage(t,n){return L.getContextValue(t,"@language",n,t.getContextRaw()["@language"]||null)}static getContextValueDirection(t,n){return L.getContextValue(t,"@direction",n,t.getContextRaw()["@direction"]||null)}static isContextValueReverse(t,n){return!!L.getContextValue(t,"@reverse",n,null)}static getContextValueIndex(t,n){return L.getContextValue(t,"@index",n,t.getContextRaw()["@index"]||null)}static isPropertyReverse(t,n,o){return o==="@reverse"!==L.isContextValueReverse(t,n)}static isPropertyInEmbeddedNode(t){return t==="@id"}static isPropertyInAnnotationObject(t){return t==="@annotation"}static isValidIri(t){return t!==null&&l.Util.isValidIri(t)}static isPrefixArray(t,n){if(t.length>n.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}async validateValueIndexes(t){if(this.parsingContext.validateValueIndexes){const n={};for(const o of t)if(o&&typeof o=="object"){const c=o["@id"],f=o["@index"];if(c&&f){const E=n[c];if(E&&E!==f)throw new l.ErrorCoded(`Conflicting @index value for ${c}`,l.ERROR_CODES.CONFLICTING_INDEXES);n[c]=f}}}}async valueToTerm(t,n,o,c,f){if(L.getContextValueType(t,n)==="@json")return[this.dataFactory.literal(this.valueToJsonString(o),this.rdfJson)];const E=typeof o;switch(E){case"object":if(o==null)return[];if(Array.isArray(o))return"@list"in L.getContextValueContainer(t,n)?o.length===0?[this.rdfNil]:this.parsingContext.idStack[c+1]||[]:(await this.validateValueIndexes(o),[]);if(t=await this.getContextSelfOrPropertyScoped(t,n),"@context"in o&&(t=await this.parsingContext.parseContext(o["@context"],(await this.parsingContext.getContext(f,0)).getContextRaw())),o=await this.unaliasKeywords(o,f,c,t),"@value"in o){let h,y,_,b,R;for(n in o){const C=o[n];switch(n){case"@value":h=C;break;case"@language":y=C;break;case"@direction":_=C;break;case"@type":b=C;break;case"@index":R=C;break;case"@annotation":break;default:throw new l.ErrorCoded(`Unknown value entry '${n}' in @value: ${JSON.stringify(o)}`,l.ERROR_CODES.INVALID_VALUE_OBJECT)}}if(await this.unaliasKeyword(b,f,c,!0,t)==="@json")return[this.dataFactory.literal(this.valueToJsonString(h),this.rdfJson)];if(h===null)return[];if(typeof h=="object")throw new l.ErrorCoded(`The value of an '@value' can not be an object, got '${JSON.stringify(h)}'`,l.ERROR_CODES.INVALID_VALUE_OBJECT_VALUE);if(this.parsingContext.validateValueIndexes&&R&&typeof R!="string")throw new l.ErrorCoded(`The value of an '@index' must be a string, got '${JSON.stringify(R)}'`,l.ERROR_CODES.INVALID_INDEX_VALUE);if(y){if(typeof h!="string")throw new l.ErrorCoded(`When an '@language' is set, the value of '@value' must be a string, got '${JSON.stringify(h)}'`,l.ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE);if(!l.ContextParser.validateLanguage(y,this.parsingContext.strictValues,l.ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING))return[];(this.parsingContext.normalizeLanguageTags||this.parsingContext.activeProcessingMode===1)&&(y=y.toLowerCase())}if(_){if(typeof h!="string")throw new Error(`When an '@direction' is set, the value of '@value' must be a string, got '${JSON.stringify(h)}'`);if(!l.ContextParser.validateDirection(_,this.parsingContext.strictValues))return[]}if(y&&_&&this.parsingContext.rdfDirection){if(b)throw new l.ErrorCoded(`Can not have '@language', '@direction' and '@type' in a value: '${JSON.stringify(o)}'`,l.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(c,h,y,_))}else if(y){if(b)throw new l.ErrorCoded(`Can not have both '@language' and '@type' in a value: '${JSON.stringify(o)}'`,l.ERROR_CODES.INVALID_VALUE_OBJECT);return[this.dataFactory.literal(h,y)]}else if(_&&this.parsingContext.rdfDirection){if(b)throw new l.ErrorCoded(`Can not have both '@direction' and '@type' in a value: '${JSON.stringify(o)}'`,l.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(c,h,y,_))}else if(b){if(typeof b!="string")throw new l.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(b)}'`,l.ERROR_CODES.INVALID_TYPED_VALUE);const C=this.createVocabOrBaseTerm(t,b);if(!C)throw new l.ErrorCoded(`Invalid '@type' value, got '${JSON.stringify(b)}'`,l.ERROR_CODES.INVALID_TYPED_VALUE);if(C.termType!=="NamedNode")throw new l.ErrorCoded(`Illegal value type (${C.termType}): ${b}`,l.ERROR_CODES.INVALID_TYPED_VALUE);return[this.dataFactory.literal(h,C)]}return await this.valueToTerm(new l.JsonLdContextNormalized({}),n,h,c,f)}else if("@set"in o){if(Object.keys(o).length>1)throw new l.ErrorCoded(`Found illegal neighbouring entries next to @set for key: '${n}'`,l.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);return[]}else if("@list"in o){if(Object.keys(o).length>1)throw new l.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${n}'`,l.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);const h=o["@list"];return Array.isArray(h)?h.length===0?[this.rdfNil]:this.parsingContext.idStack[c+1]||[]:await this.valueToTerm(await this.parsingContext.getContext(f),n,h,c-1,f.slice(0,-1))}else{if("@reverse"in o&&typeof o["@reverse"]=="boolean")return[];if("@graph"in L.getContextValueContainer(await this.parsingContext.getContext(f),n)){const h=this.parsingContext.graphContainerTermStack[c+1];return h?Object.values(h):[this.dataFactory.blankNode()]}else if("@id"in o){if(Object.keys(o).length>1&&(t=await this.parsingContext.getContext(f,0)),"@context"in o&&(t=await this.parsingContext.parseContext(o["@context"],t.getContextRaw())),o["@type"]==="@vocab")return this.nullableTermToArray(this.createVocabOrBaseTerm(t,o["@id"]));{const h=o["@id"];let y;if(typeof h=="object")if(this.parsingContext.rdfstar)y=this.parsingContext.idStack[c+1][0];else throw new l.ErrorCoded(`Found illegal @id '${o}'`,l.ERROR_CODES.INVALID_ID_VALUE);else y=this.resourceToTerm(t,h);return this.nullableTermToArray(y)}}else return this.parsingContext.emittedStack[c+1]||o&&typeof o=="object"&&Object.keys(o).length===0?this.parsingContext.idStack[c+1]||(this.parsingContext.idStack[c+1]=[this.dataFactory.blankNode()]):[]}case"string":return this.nullableTermToArray(this.stringValueToTerm(c,await this.getContextSelfOrPropertyScoped(t,n),n,o,null));case"boolean":return this.nullableTermToArray(this.stringValueToTerm(c,await this.getContextSelfOrPropertyScoped(t,n),n,(!!o).toString(),this.dataFactory.namedNode(L.XSD_BOOLEAN)));case"number":return this.nullableTermToArray(this.stringValueToTerm(c,await this.getContextSelfOrPropertyScoped(t,n),n,o,this.dataFactory.namedNode(o%1===0&&o<1e21?L.XSD_INTEGER:L.XSD_DOUBLE)));default:return this.parsingContext.emitError(new Error(`Could not determine the RDF type of a ${E}`)),[]}}async getContextSelfOrPropertyScoped(t,n){const o=t.getContextRaw()[n];return o&&typeof o=="object"&&"@context"in o&&(t=await this.parsingContext.parseContext(o,t.getContextRaw(),!0)),t}nullableTermToArray(t){return t?[t]:[]}predicateToTerm(t,n){const o=t.expandTerm(n,!0,this.parsingContext.getExpandOptions());if(!o)return null;if(o[0]==="_"&&o[1]===":")return this.parsingContext.produceGeneralizedRdf?this.dataFactory.blankNode(o.substr(2)):null;if(L.isValidIri(o))return this.dataFactory.namedNode(o);if(o&&this.parsingContext.strictValues)this.parsingContext.emitError(new l.ErrorCoded(`Invalid predicate IRI: ${o}`,l.ERROR_CODES.INVALID_IRI_MAPPING));else return null;return null}resourceToTerm(t,n){if(n.startsWith("_:"))return this.dataFactory.blankNode(n.substr(2));const o=t.expandTerm(n,!1,this.parsingContext.getExpandOptions());if(!L.isValidIri(o))if(o&&this.parsingContext.strictValues)this.parsingContext.emitError(new Error(`Invalid resource IRI: ${o}`));else return null;return this.dataFactory.namedNode(o)}createVocabOrBaseTerm(t,n){if(n.startsWith("_:"))return this.dataFactory.blankNode(n.substr(2));const o=this.parsingContext.getExpandOptions();let c=t.expandTerm(n,!0,o);if(c===n&&(c=t.expandTerm(n,!1,o)),!L.isValidIri(c))if(c&&this.parsingContext.strictValues&&!c.startsWith("@"))this.parsingContext.emitError(new Error(`Invalid term IRI: ${c}`));else return null;return this.dataFactory.namedNode(c)}intToString(t,n){return typeof t=="number"?Number.isFinite(t)?t%1===0&&(!n||n.value!==L.XSD_DOUBLE)?Number(t).toString():t.toExponential(15).replace(/(\d)0*e\+?/,"$1E"):t>0?"INF":"-INF":t}stringValueToTerm(t,n,o,c,f){const E=L.getContextValueType(n,o);if(E)if(E==="@id"){if(!f)return this.resourceToTerm(n,this.intToString(c,f))}else if(E==="@vocab"){if(!f)return this.createVocabOrBaseTerm(n,this.intToString(c,f))}else f=this.dataFactory.namedNode(E);if(!f){const h=L.getContextValueLanguage(n,o),y=L.getContextValueDirection(n,o);return y&&this.parsingContext.rdfDirection?this.createLanguageDirectionLiteral(t,this.intToString(c,f),h,y):this.dataFactory.literal(this.intToString(c,f),h)}return this.dataFactory.literal(this.intToString(c,f),f)}createLanguageDirectionLiteral(t,n,o,c){if(this.parsingContext.rdfDirection==="i18n-datatype")return o||(o=""),this.dataFactory.literal(n,this.dataFactory.namedNode(`https://www.w3.org/ns/i18n#${o}_${c}`));{const f=this.dataFactory.blankNode(),E=this.getDefaultGraph();return this.parsingContext.emitQuad(t,this.dataFactory.quad(f,this.dataFactory.namedNode(L.RDF+"value"),this.dataFactory.literal(n),E)),o&&this.parsingContext.emitQuad(t,this.dataFactory.quad(f,this.dataFactory.namedNode(L.RDF+"language"),this.dataFactory.literal(o),E)),this.parsingContext.emitQuad(t,this.dataFactory.quad(f,this.dataFactory.namedNode(L.RDF+"direction"),this.dataFactory.literal(c),E)),f}}valueToJsonString(t){return d(t)}async unaliasKeyword(t,n,o,c,f){if(Number.isInteger(t))return t;if(!c){const E=this.parsingContext.unaliasedKeywordCacheStack[o];if(E)return E}if(!l.Util.isPotentialKeyword(t)){f=f||await this.parsingContext.getContext(n);let E=f.getContextRaw()[t];E&&typeof E=="object"&&(E=E["@id"]),l.Util.isValidKeyword(E)&&(t=E)}return c?t:this.parsingContext.unaliasedKeywordCacheStack[o]=t}async unaliasKeywordParent(t,n){return await this.unaliasKeyword(n>0&&t[n-1],t,n-1)}async unaliasKeywords(t,n,o,c){const f={};for(const E in t)f[await this.unaliasKeyword(E,n,o+1,!0,c)]=t[E];return f}async isLiteral(t,n){for(let o=n;o>=0;o--){if(await this.unaliasKeyword(t[o],t,o)==="@annotation")return!1;if(this.parsingContext.literalStack[o]||this.parsingContext.jsonLiteralStack[o])return!0}return!1}async getDepthOffsetGraph(t,n){for(let o=t-1;o>0;o--)if(await this.unaliasKeyword(n[o],n,o)==="@graph"){const c=(await r.EntryHandlerContainer.getContainerHandler(this.parsingContext,n,o)).containers;return r.EntryHandlerContainer.isComplexGraphContainer(c)?-1:t-o-1}return-1}validateReverseSubject(t){if(t.termType==="Literal")throw new l.ErrorCoded(`Found illegal literal in subject position: ${t.value}`,l.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}getDefaultGraph(){return this.parsingContext.defaultGraph||this.dataFactory.defaultGraph()}async getGraphContainerValue(t,n){let o=this.getDefaultGraph();const{containers:c,depth:f}=await r.EntryHandlerContainer.getContainerHandler(this.parsingContext,t,n);if("@graph"in c){const E=r.EntryHandlerContainer.getContainerGraphIndex(c,f,t),h=this.parsingContext.graphContainerTermStack[f];if(o=h?h[E]:null,!o){let y=null;if("@id"in c){const _=await this.getContainerKey(t[f],t,f);_!==null&&(y=await this.resourceToTerm(await this.parsingContext.getContext(t),_))}y||(y=this.dataFactory.blankNode()),this.parsingContext.graphContainerTermStack[f]||(this.parsingContext.graphContainerTermStack[f]={}),o=this.parsingContext.graphContainerTermStack[f][E]=y}}return o}async getPropertiesDepth(t,n){let o=n;for(let c=n-1;c>0;c--)if(typeof t[c]!="number"){const f=await this.unaliasKeyword(t[c],t,c);if(f==="@reverse")return c;if(f==="@nest")o=c;else return o}return o}async getContainerKey(t,n,o){const c=await this.unaliasKeyword(t,n,o);return c==="@none"?null:c}validateReverseInEmbeddedNode(t,n,o){if(o&&n&&!this.parsingContext.rdfstarReverseInEmbedded)throw new l.ErrorCoded(`Illegal reverse property in embedded node in ${t}`,l.ERROR_CODES.INVALID_EMBEDDED_NODE)}emitQuadChecked(t,n,o,c,f,E,h){let y;if(E?(this.validateReverseSubject(c),y=this.dataFactory.quad(c,o,n,f)):y=this.dataFactory.quad(n,o,c,f),h){if(y.graph.termType!=="DefaultGraph"&&(y=this.dataFactory.quad(y.subject,y.predicate,y.object)),this.parsingContext.idStack[t-1])throw new l.ErrorCoded("Illegal multiple properties in an embedded node",l.ERROR_CODES.INVALID_EMBEDDED_NODE);this.parsingContext.idStack[t-1]=[y]}else this.parsingContext.emitQuad(t,y);const _=this.parsingContext.annotationsBuffer[t];if(_){for(const b of _)this.emitAnnotation(t,y,b);delete this.parsingContext.annotationsBuffer[t]}}emitAnnotation(t,n,o){let c;o.reverse?(this.validateReverseSubject(o.object),c=this.dataFactory.quad(o.object,o.predicate,n)):c=this.dataFactory.quad(n,o.predicate,o.object),this.parsingContext.emitQuad(t,c);for(const f of o.nestedAnnotations)this.emitAnnotation(t,c,f)}};return s.XSD="http://www.w3.org/2001/XMLSchema#",s.XSD_BOOLEAN=s.XSD+"boolean",s.XSD_INTEGER=s.XSD+"integer",s.XSD_DOUBLE=s.XSD+"double",s.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#",oe.Util=s,oe}Object.defineProperty(Te,"__esModule",{value:!0});Te.EntryHandlerArrayValue=void 0;const Or=ee(),Ot=F;class Rr{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,d,s,a){return this.test(e,r,null,d,s)}async test(e,r,d,s,a){return typeof s[a]=="number"}async handle(e,r,d,s,a,t){let n=await r.unaliasKeywordParent(s,t);if(n==="@list"){let o=null,c=0;for(let f=t-2;f>0;f--){const E=s[f];if(typeof E=="string"||typeof E=="number"){c=f,o=E;break}}if(o!==null){const f=await r.valueToTerm(await e.getContext(s),o,a,t,s);for(const E of f)await this.handleListElement(e,r,E,a,t,s.slice(0,c),c);f.length===0&&await this.handleListElement(e,r,null,a,t,s.slice(0,c),c)}}else if(n==="@set")await e.newOnValueJob(s.slice(0,-2),a,t-2,!1);else if(n!==void 0&&n!=="@type"){for(let c=t-1;c>0;c--)if(typeof s[c]!="number"){n=await r.unaliasKeyword(s[c],s,c);break}const o=await e.getContext(s.slice(0,-1));if("@list"in Or.Util.getContextValueContainer(o,n)){e.emittedStack[t+1]=!0;const c=await r.valueToTerm(await e.getContext(s),n,a,t,s);for(const f of c)await this.handleListElement(e,r,f,a,t,s.slice(0,-1),t-1);c.length===0&&await this.handleListElement(e,r,null,a,t,s.slice(0,-1),t-1)}else e.shiftStack(t,1),await e.newOnValueJob(s.slice(0,-1),a,t-1,!1),e.contextTree.removeContext(s.slice(0,-1))}}async handleListElement(e,r,d,s,a,t,n){let o=e.listPointerStack[a];if(s!==null&&(await r.unaliasKeywords(s,t,a))["@value"]!==null){if(!o||!o.value){const c=r.dataFactory.blankNode();o={value:c,listRootDepth:n,listId:c}}else{const c=r.dataFactory.blankNode();e.emitQuad(a,r.dataFactory.quad(o.value,r.rdfRest,c,r.getDefaultGraph())),o.value=c}d&&e.emitQuad(a,r.dataFactory.quad(o.value,r.rdfFirst,d,r.getDefaultGraph()))}else o||(o={listRootDepth:n,listId:r.rdfNil});e.listPointerStack[a]=o,e.rdfstar&&e.annotationsBuffer[a]&&e.emitError(new Ot.ErrorCoded("Found an illegal annotation inside a list",Ot.ERROR_CODES.INVALID_ANNOTATION))}}Te.EntryHandlerArrayValue=Rr;var ve={};Object.defineProperty(ve,"__esModule",{value:!0});ve.EntryHandlerInvalidFallback=void 0;class mr{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,d,s,a){return!1}async test(e,r,d,s,a){return!0}async handle(e,r,d,s,a,t){e.emittedStack[t]=!1}}ve.EntryHandlerInvalidFallback=mr;var De={},k={};Object.defineProperty(k,"__esModule",{value:!0});k.EntryHandlerKeyword=void 0;class Sr{constructor(e){this.keyword=e}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,d,s,a){return!1}async test(e,r,d,s,a){return d===this.keyword}}k.EntryHandlerKeyword=Sr;Object.defineProperty(De,"__esModule",{value:!0});De.EntryHandlerKeywordContext=void 0;const Rt=F,Tr=k;class xr extends Tr.EntryHandlerKeyword{constructor(){super("@context")}isStackProcessor(){return!1}async handle(e,r,d,s,a,t){e.streamingProfile&&(e.processingStack[t]||e.processingType[t]||e.idStack[t]!==void 0)&&e.emitError(new Rt.ErrorCoded("Found an out-of-order context, while streaming is enabled.(disable `streamingProfile`)",Rt.ERROR_CODES.INVALID_STREAMING_KEY_ORDER));const n=e.getContext(s),o=e.parseContext(a,(await n).getContextRaw());e.contextTree.setContext(s.slice(0,-1),o),e.emitContext(a),await e.validateContext(await o)}}De.EntryHandlerKeywordContext=xr;var Le={};Object.defineProperty(Le,"__esModule",{value:!0});Le.EntryHandlerKeywordGraph=void 0;const Ar=k;class Nr extends Ar.EntryHandlerKeyword{constructor(){super("@graph")}async handle(e,r,d,s,a,t){e.graphStack[t+1]=!0}}Le.EntryHandlerKeywordGraph=Nr;var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.EntryHandlerKeywordId=void 0;const $=F,vr=k;class Dr extends vr.EntryHandlerKeyword{constructor(){super("@id")}isStackProcessor(){return!1}async handle(e,r,d,s,a,t){if(typeof a!="string"){if(e.rdfstar&&typeof a=="object"){const o=Object.keys(a);o.length===1&&o[0]==="@id"&&e.emitError(new $.ErrorCoded(`Invalid embedded node without property with @id ${a["@id"]}`,$.ERROR_CODES.INVALID_EMBEDDED_NODE))}else e.emitError(new $.ErrorCoded(`Found illegal @id '${a}'`,$.ERROR_CODES.INVALID_ID_VALUE));return}const n=await r.getPropertiesDepth(s,t);if(e.idStack[n]!==void 0&&(e.idStack[n][0].listHead?e.emitError(new $.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${s[t-1]}'`,$.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT)):e.emitError(new $.ErrorCoded(`Found duplicate @ids '${e.idStack[n][0].value}' and '${a}'`,$.ERROR_CODES.COLLIDING_KEYWORDS))),e.rdfstar&&e.annotationsBuffer[t])for(const o of e.annotationsBuffer[t])o.depth===t&&e.emitError(new $.ErrorCoded(`Found an illegal @id inside an annotation: ${a}`,$.ERROR_CODES.INVALID_ANNOTATION));e.idStack[n]=r.nullableTermToArray(await r.resourceToTerm(await e.getContext(s),a))}}Pe.EntryHandlerKeywordId=Dr;var Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.EntryHandlerKeywordIncluded=void 0;const te=F,Lr=k;class Pr extends Lr.EntryHandlerKeyword{constructor(){super("@included")}async handle(e,r,d,s,a,t){typeof a!="object"&&e.emitError(new te.ErrorCoded(`Found illegal @included '${a}'`,te.ERROR_CODES.INVALID_INCLUDED_VALUE));const n=await r.unaliasKeywords(a,s,t,await e.getContext(s));"@value"in n&&e.emitError(new te.ErrorCoded(`Found an illegal @included @value node '${JSON.stringify(a)}'`,te.ERROR_CODES.INVALID_INCLUDED_VALUE)),"@list"in n&&e.emitError(new te.ErrorCoded(`Found an illegal @included @list node '${JSON.stringify(a)}'`,te.ERROR_CODES.INVALID_INCLUDED_VALUE)),e.emittedStack[t]=!1}}Ve.EntryHandlerKeywordIncluded=Pr;var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.EntryHandlerKeywordNest=void 0;const Ie=F,Vr=k;class Ur extends Vr.EntryHandlerKeyword{constructor(){super("@nest")}async handle(e,r,d,s,a,t){typeof a!="object"&&e.emitError(new Ie.ErrorCoded(`Found invalid @nest entry for '${d}': '${a}'`,Ie.ERROR_CODES.INVALID_NEST_VALUE)),"@value"in await r.unaliasKeywords(a,s,t,await e.getContext(s))&&e.emitError(new Ie.ErrorCoded(`Found an invalid @value node for '${d}'`,Ie.ERROR_CODES.INVALID_NEST_VALUE)),e.emittedStack[t]=!1}}Ue.EntryHandlerKeywordNest=Ur;var je={};Object.defineProperty(je,"__esModule",{value:!0});je.EntryHandlerKeywordType=void 0;const ue=F,Ce=ee(),jr=Ae(),Fr=k;class Br extends Fr.EntryHandlerKeyword{constructor(){super("@type")}isStackProcessor(){return!1}async handle(e,r,d,s,a,t){const n=s[t],o=await e.getContext(s),c=r.rdfType,f=await r.unaliasKeywordParent(s,t),E=Ce.Util.isPropertyReverse(o,n,f),h=Ce.Util.isPropertyInEmbeddedNode(f);r.validateReverseInEmbeddedNode(d,E,h);const y=Ce.Util.isPropertyInAnnotationObject(f),_=Array.isArray(a)?a:[a];for(const C of _){typeof C!="string"&&e.emitError(new ue.ErrorCoded(`Found illegal @type '${C}'`,ue.ERROR_CODES.INVALID_TYPE_VALUE));const P=r.createVocabOrBaseTerm(o,C);P&&await jr.EntryHandlerPredicate.handlePredicateObject(e,r,s,t,c,P,E,h,y)}let b=Promise.resolve(o),R=!1;for(const C of _.sort()){const P=Ce.Util.getContextValue(o,"@context",C,null);P&&(R=!0,b=b.then(N=>e.parseContext(P,N.getContextRaw())))}e.streamingProfile&&(R||!e.streamingProfileAllowOutOfOrderPlainType)&&(e.processingStack[t]||e.idStack[t])&&e.emitError(new ue.ErrorCoded("Found an out-of-order type-scoped context, while streaming is enabled.(disable `streamingProfile`)",ue.ERROR_CODES.INVALID_STREAMING_KEY_ORDER)),R&&(b=b.then(C=>C.getContextRaw()["@propagate"]!==!0?new ue.JsonLdContextNormalized(Object.assign(Object.assign({},C.getContextRaw()),{"@propagate":!1,"@__propagateFallback":o.getContextRaw()})):C),e.contextTree.setContext(s.slice(0,s.length-1),b)),e.processingType[t]=!0}}je.EntryHandlerKeywordType=Br;var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.EntryHandlerKeywordUnknownFallback=void 0;const Ee=F;class Be{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,d,s,a){const t=await r.unaliasKeyword(d[s],d,s);return Ee.Util.isPotentialKeyword(t)?!(!a&&t==="@list"):!1}async test(e,r,d,s,a){return Ee.Util.isPotentialKeyword(d)}async handle(e,r,d,s,a,t){const n=Be.VALID_KEYWORDS_TYPES[d];n!==void 0?n&&typeof a!==n.type&&e.emitError(new Ee.ErrorCoded(`Invalid value type for '${d}' with value '${a}'`,n.errorCode)):e.strictValues&&e.emitError(new Error(`Unknown keyword '${d}' with value '${a}'`)),e.emittedStack[t]=!1}}Be.VALID_KEYWORDS_TYPES={"@index":{type:"string",errorCode:Ee.ERROR_CODES.INVALID_INDEX_VALUE},"@list":null,"@reverse":{type:"object",errorCode:Ee.ERROR_CODES.INVALID_REVERSE_VALUE},"@set":null,"@value":null};Fe.EntryHandlerKeywordUnknownFallback=Be;var He={};Object.defineProperty(He,"__esModule",{value:!0});He.EntryHandlerKeywordValue=void 0;const Hr=k;class Kr extends Hr.EntryHandlerKeyword{constructor(){super("@value")}async validate(e,r,d,s,a){const t=d[s];return t&&!e.literalStack[s]&&await this.test(e,r,t,d,s)&&(e.literalStack[s]=!0),super.validate(e,r,d,s,a)}async test(e,r,d,s,a){return await r.unaliasKeyword(s[a],s.slice(0,s.length-1),a-1,!0)==="@value"}async handle(e,r,d,s,a,t){e.literalStack[t]=!0,delete e.unidentifiedValuesBuffer[t],delete e.unidentifiedGraphsBuffer[t],e.emittedStack[t]=!1}}He.EntryHandlerKeywordValue=Kr;var he={},Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.ContextTree=void 0;class Qe{constructor(){this.subTrees={}}getContext(e){if(e.length>0){const[r,...d]=e,s=this.subTrees[r];if(s){const a=s.getContext(d);if(a)return a.then(({context:t,depth:n})=>({context:t,depth:n+1}))}}return this.context?this.context.then(r=>({context:r,depth:0})):null}setContext(e,r){if(e.length===0)this.context=r;else{const[d,...s]=e;let a=this.subTrees[d];a||(a=this.subTrees[d]=new Qe),a.setContext(s,r)}}removeContext(e){this.setContext(e,null)}}Ke.ContextTree=Qe;var mt;function Gr(){if(mt)return he;mt=1,Object.defineProperty(he,"__esModule",{value:!0}),he.ParsingContext=void 0;const l=F,e=ie,r=Ke,d=$t();let s=class kt{constructor(t){this.contextParser=new l.ContextParser({documentLoader:t.documentLoader,skipValidation:t.skipContextValidation}),this.streamingProfile=!!t.streamingProfile,this.baseIRI=t.baseIRI,this.produceGeneralizedRdf=!!t.produceGeneralizedRdf,this.allowSubjectList=!!t.allowSubjectList,this.processingMode=t.processingMode||d.JsonLdParser.DEFAULT_PROCESSING_MODE,this.strictValues=!!t.strictValues,this.validateValueIndexes=!!t.validateValueIndexes,this.defaultGraph=t.defaultGraph,this.rdfDirection=t.rdfDirection,this.normalizeLanguageTags=t.normalizeLanguageTags,this.streamingProfileAllowOutOfOrderPlainType=t.streamingProfileAllowOutOfOrderPlainType,this.rdfstar=t.rdfstar!==!1,this.rdfstarReverseInEmbedded=t.rdfstarReverseInEmbedded,this.topLevelProperties=!1,this.activeProcessingMode=parseFloat(this.processingMode),this.processingStack=[],this.processingType=[],this.emittedStack=[],this.idStack=[],this.graphStack=[],this.graphContainerTermStack=[],this.listPointerStack=[],this.contextTree=new r.ContextTree,this.literalStack=[],this.validationStack=[],this.unaliasedKeywordCacheStack=[],this.jsonLiteralStack=[],this.unidentifiedValuesBuffer=[],this.unidentifiedGraphsBuffer=[],this.annotationsBuffer=[],this.pendingContainerFlushBuffers=[],this.parser=t.parser,t.context?(this.rootContext=this.parseContext(t.context),this.rootContext.then(n=>this.validateContext(n))):this.rootContext=Promise.resolve(new l.JsonLdContextNormalized(this.baseIRI?{"@base":this.baseIRI,"@__baseDocument":!0}:{}))}async parseContext(t,n,o){return this.contextParser.parse(t,{baseIRI:this.baseIRI,ignoreProtection:o,normalizeLanguageTags:this.normalizeLanguageTags,parentContext:n,processingMode:this.activeProcessingMode})}validateContext(t){const n=t.getContextRaw()["@version"];if(n){if(this.activeProcessingMode&&n>this.activeProcessingMode)throw new e.ErrorCoded(`Unsupported JSON-LD version '${n}' under active processing mode ${this.activeProcessingMode}.`,e.ERROR_CODES.PROCESSING_MODE_CONFLICT);if(this.activeProcessingMode&&n<this.activeProcessingMode)throw new e.ErrorCoded(`Invalid JSON-LD version ${n} under active processing mode ${this.activeProcessingMode}.`,e.ERROR_CODES.INVALID_VERSION_VALUE);this.activeProcessingMode=n}}async getContext(t,n=1){const o=t;for(;typeof t[t.length-1]=="number";)t=t.slice(0,t.length-1);n&&(t=t.slice(0,-n));const c=await this.getContextPropagationAware(t);let E=c.context.getContextRaw();for(let h=c.depth;h<o.length-n;h++){const y=o[h],_=E[y];if(_&&typeof _=="object"&&"@context"in _){const b=(await this.parseContext(_,E,!0)).getContextRaw(),R=!(y in b)||b[y]["@context"]["@propagate"];(R!==!1||h===o.length-1-n)&&(E=Object.assign({},b),delete E["@propagate"],E[y]=Object.assign({},E[y]),"@id"in _&&(E[y]["@id"]=_["@id"]),delete E[y]["@context"],R!==!1&&this.contextTree.setContext(o.slice(0,h+n),Promise.resolve(new l.JsonLdContextNormalized(E))))}}return new l.JsonLdContextNormalized(E)}async getContextPropagationAware(t){const n=t.length;let o=null,c;do{c=!1,o&&"@__propagateFallback"in o.context.getContextRaw()?o.context=new l.JsonLdContextNormalized(o.context.getContextRaw()["@__propagateFallback"]):(o&&(t=t.slice(0,o.depth-1)),o=await this.contextTree.getContext(t)||{context:await this.rootContext,depth:0});const f=t[t.length-1];if(f in o.context.getContextRaw()){const E=o.context.getContextRaw()[f];E&&typeof E=="object"&&"@context"in E&&(c=!0)}}while(o.depth>0&&o.context.getContextRaw()["@propagate"]===!1&&o.depth!==n&&!c);return o.depth===0&&o.context.getContextRaw()["@propagate"]===!1&&o.depth!==n&&(o.context=new l.JsonLdContextNormalized({})),o}async newOnValueJob(t,n,o,c){await this.parser.newOnValueJob(t,n,o,c)}async handlePendingContainerFlushBuffers(){if(this.pendingContainerFlushBuffers.length>0){for(const t of this.pendingContainerFlushBuffers)await this.parser.flushBuffer(t.depth,t.keys),this.parser.flushStacks(t.depth);return this.pendingContainerFlushBuffers.splice(0,this.pendingContainerFlushBuffers.length),!0}else return!1}emitQuad(t,n){t===1&&(this.topLevelProperties=!0),this.parser.push(n)}emitError(t){this.parser.emit("error",t)}emitContext(t){this.parser.emit("context",t)}getUnidentifiedValueBufferSafe(t){let n=this.unidentifiedValuesBuffer[t];return n||(n=[],this.unidentifiedValuesBuffer[t]=n),n}getUnidentifiedGraphBufferSafe(t){let n=this.unidentifiedGraphsBuffer[t];return n||(n=[],this.unidentifiedGraphsBuffer[t]=n),n}getAnnotationsBufferSafe(t){let n=this.annotationsBuffer[t];return n||(n=[],this.annotationsBuffer[t]=n),n}getExpandOptions(){return kt.EXPAND_OPTIONS[this.activeProcessingMode]}shiftStack(t,n){const o=this.idStack[t+n];if(o&&(this.idStack[t]=o,this.emittedStack[t]=!0,delete this.idStack[t+n]),this.pendingContainerFlushBuffers.length)for(const c of this.pendingContainerFlushBuffers)c.depth>=t+n&&(c.depth-=n,c.keys.splice(t,n));this.unidentifiedValuesBuffer[t+n]&&(this.unidentifiedValuesBuffer[t]=this.unidentifiedValuesBuffer[t+n],delete this.unidentifiedValuesBuffer[t+n]),this.annotationsBuffer[t+n-1]&&(this.annotationsBuffer[t-1]||(this.annotationsBuffer[t-1]=[]),this.annotationsBuffer[t-1]=[...this.annotationsBuffer[t-1],...this.annotationsBuffer[t+n-1]],delete this.annotationsBuffer[t+n-1])}};return s.EXPAND_OPTIONS={1:{allowPrefixForcing:!1,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!1},1.1:{allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}},he.ParsingContext=s,he}var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.EntryHandlerKeywordAnnotation=void 0;const kr=k,St=F;class $r extends kr.EntryHandlerKeyword{constructor(){super("@annotation")}async handle(e,r,d,s,a,t){(typeof a=="string"||typeof a=="object"&&a["@value"])&&e.emitError(new St.ErrorCoded(`Found illegal annotation value: ${JSON.stringify(a)}`,St.ERROR_CODES.INVALID_ANNOTATION))}}Ge.EntryHandlerKeywordAnnotation=$r;var Tt;function $t(){if(Tt)return se;Tt=1,Object.defineProperty(se,"__esModule",{value:!0}),se.JsonLdParser=void 0;const l=ar,e=F,r=At,d=Te,s=Gt(),a=ve,t=Ae(),n=De,o=Le,c=Pe,f=Ve,E=Ue,h=je,y=Fe,_=He,b=Gr(),R=ee(),C=Ft,P=Ge;let N=class re extends r.Transform{constructor(w){super({readableObjectMode:!0}),w=w||{},this.options=w,this.parsingContext=new b.ParsingContext(Object.assign({parser:this},w)),this.util=new R.Util({dataFactory:w.dataFactory,parsingContext:this.parsingContext}),this.jsonParser=new l,this.contextJobs=[],this.typeJobs=[],this.contextAwaitingJobs=[],this.lastDepth=0,this.lastKeys=[],this.lastOnValueJob=Promise.resolve(),this.attachJsonParserListeners(),this.on("end",()=>{typeof this.jsonParser.mode<"u"&&this.emit("error",new Error("Unclosed document"))})}static fromHttpResponse(w,I,S,D){let u;if(I!=="application/ld+json"){if(I!=="application/json"&&!I.endsWith("+json"))throw new e.ErrorCoded(`Unsupported JSON-LD media type ${I}`,e.ERROR_CODES.LOADING_DOCUMENT_FAILED);if(S&&S.has("Link")&&S.forEach((O,x)=>{if(x==="link"){const v=(0,C.parse)(O);for(const m of v.get("rel","http://www.w3.org/ns/json-ld#context")){if(u)throw new e.ErrorCoded("Multiple JSON-LD context link headers were found on "+w,e.ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS);u=m.uri}}}),!u&&!(D!=null&&D.ignoreMissingContextLinkHeader))throw new e.ErrorCoded(`Missing context link header for media type ${I} on ${w}`,e.ERROR_CODES.LOADING_DOCUMENT_FAILED)}let p;if(S&&S.has("Content-Type")){const O=S.get("Content-Type"),x=/; *profile=([^"]*)/.exec(O);x&&x[1]==="http://www.w3.org/ns/json-ld#streaming"&&(p=!0)}return new re(Object.assign({baseIRI:w,context:u,streamingProfile:p},D||{}))}import(w){if("pipe"in w){w.on("error",S=>I.emit("error",S));const I=w.pipe(new re(this.options));return I}else{const I=new r.PassThrough({readableObjectMode:!0});w.on("error",D=>S.emit("error",D)),w.on("data",D=>I.push(D)),w.on("end",()=>I.push(null));const S=I.pipe(new re(this.options));return S}}_transform(w,I,S){this.jsonParser.write(w),this.lastOnValueJob.then(()=>S(),D=>S(D))}async newOnValueJob(w,I,S,D){let u=!0;if(D&&S<this.lastDepth){const m=this.parsingContext.listPointerStack[this.lastDepth];m&&(m.value&&this.push(this.util.dataFactory.quad(m.value,this.util.rdfRest,this.util.rdfNil,this.util.getDefaultGraph())),m.listId.listHead=!0,this.parsingContext.idStack[m.listRootDepth+1]=[m.listId],this.parsingContext.listPointerStack.splice(this.lastDepth,1)),await s.EntryHandlerContainer.isBufferableContainerHandler(this.parsingContext,this.lastKeys,this.lastDepth)?(this.parsingContext.pendingContainerFlushBuffers.push({depth:this.lastDepth,keys:this.lastKeys.slice(0,this.lastKeys.length)}),u=!1):await this.flushBuffer(this.lastDepth,this.lastKeys)}const p=await this.util.unaliasKeyword(w[S],w,S),O=await this.util.unaliasKeywordParent(w,S);this.parsingContext.emittedStack[S]=!0;let x=!0;e.Util.isValidKeyword(p)&&O==="@reverse"&&p!=="@context"&&this.emit("error",new e.ErrorCoded(`Found the @id '${I}' inside an @reverse property`,e.ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP));let v=!1;this.parsingContext.validationStack.length>1&&(v=this.parsingContext.validationStack[this.parsingContext.validationStack.length-1].property);for(let m=Math.max(1,this.parsingContext.validationStack.length-1);m<w.length-1;m++){const j=this.parsingContext.validationStack[m]||(this.parsingContext.validationStack[m]=await this.validateKey(w.slice(0,m+1),m,v));if(j.valid)!v&&j.property&&(v=!0);else{this.parsingContext.emittedStack[S]=!1,x=!1;break}}if(await this.util.isLiteral(w,S)&&(x=!1),x)for(const m of re.ENTRY_HANDLERS){const j=await m.test(this.parsingContext,this.util,p,w,S);if(j){await m.handle(this.parsingContext,this.util,p,w,I,S,j),m.isStackProcessor()&&(this.parsingContext.processingStack[S]=!0);break}}S===0&&Array.isArray(I)&&await this.util.validateValueIndexes(I),u&&S<this.lastDepth&&this.flushStacks(this.lastDepth),this.lastDepth=S,this.lastKeys=w,this.parsingContext.unaliasedKeywordCacheStack.splice(S-1)}flushStacks(w){this.parsingContext.processingStack.splice(w,1),this.parsingContext.processingType.splice(w,1),this.parsingContext.emittedStack.splice(w,1),this.parsingContext.idStack.splice(w,1),this.parsingContext.graphStack.splice(w+1,1),this.parsingContext.graphContainerTermStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1),this.parsingContext.validationStack.splice(w-1,2),this.parsingContext.literalStack.splice(w,this.parsingContext.literalStack.length-w),this.parsingContext.annotationsBuffer.splice(w,1)}async flushBuffer(w,I){let S=this.parsingContext.idStack[w];!!S||(S=this.parsingContext.idStack[w]=[this.util.dataFactory.blankNode()]);const u=this.parsingContext.unidentifiedValuesBuffer[w];if(u){for(const x of S){const v=await this.util.getDepthOffsetGraph(w,I),m=this.parsingContext.graphStack[w]||v>=0?this.parsingContext.idStack[w-v-1]:[await this.util.getGraphContainerValue(I,w)];if(m)for(const j of m){this.parsingContext.emittedStack[w]=!0;for(const U of u)this.util.emitQuadChecked(w,x,U.predicate,U.object,j,U.reverse,U.isEmbedded)}else{const j=this.parsingContext.getUnidentifiedGraphBufferSafe(w-await this.util.getDepthOffsetGraph(w,I)-1);for(const U of u)U.reverse?j.push({object:x,predicate:U.predicate,subject:U.object,isEmbedded:U.isEmbedded}):j.push({object:U.object,predicate:U.predicate,subject:x,isEmbedded:U.isEmbedded})}}this.parsingContext.unidentifiedValuesBuffer.splice(w,1),this.parsingContext.literalStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1)}const p=this.parsingContext.unidentifiedGraphsBuffer[w];if(p){for(const x of S){const v=w===1&&x.termType==="BlankNode"&&!this.parsingContext.topLevelProperties?this.util.getDefaultGraph():x;this.parsingContext.emittedStack[w]=!0;for(const m of p)this.parsingContext.emitQuad(w,this.util.dataFactory.quad(m.subject,m.predicate,m.object,v))}this.parsingContext.unidentifiedGraphsBuffer.splice(w,1)}const O=this.parsingContext.annotationsBuffer[w];if(O){O.length>0&&w===1&&this.parsingContext.emitError(new e.ErrorCoded("Annotations can not be made on top-level nodes",e.ERROR_CODES.INVALID_ANNOTATION));const x=this.parsingContext.getAnnotationsBufferSafe(w-1);for(const v of O)x.push(v);delete this.parsingContext.annotationsBuffer[w]}}async validateKey(w,I,S){for(const D of re.ENTRY_HANDLERS)if(await D.validate(this.parsingContext,this.util,w,I,S))return{valid:!0,property:S||D.isPropertyHandler()};return{valid:!1,property:!1}}attachJsonParserListeners(){this.jsonParser.onValue=w=>{const I=this.jsonParser.stack.length,S=new Array(I+1).fill(0).map((D,u)=>u===I?this.jsonParser.key:this.jsonParser.stack[u].key);if(!this.isParsingContextInner(I)){const D=()=>this.newOnValueJob(S,w,I,!0);if(!this.parsingContext.streamingProfile&&!this.parsingContext.contextTree.getContext(S.slice(0,-1)))if(S[I]==="@context"){let u=this.contextJobs[I];u||(u=this.contextJobs[I]=[]),u.push(D)}else this.contextAwaitingJobs.push({job:D,keys:S,depth:I});else this.lastOnValueJob=this.lastOnValueJob.then(D);!this.parsingContext.streamingProfile&&I===0&&(this.lastOnValueJob=this.lastOnValueJob.then(()=>this.executeBufferedJobs()))}},this.jsonParser.onError=w=>{this.emit("error",w)}}isParsingContextInner(w){for(let I=w;I>0;I--)if(this.jsonParser.stack[I-1].key==="@context")return!0;return!1}async executeBufferedJobs(){for(const I of this.contextJobs)if(I)for(const S of I)await S();this.parsingContext.unaliasedKeywordCacheStack.splice(0);const w=[];for(const I of this.contextAwaitingJobs)await this.util.unaliasKeyword(I.keys[I.depth],I.keys,I.depth,!0)==="@type"||typeof I.keys[I.depth]=="number"&&await this.util.unaliasKeyword(I.keys[I.depth-1],I.keys,I.depth-1,!0)==="@type"?this.typeJobs.push({job:I.job,keys:I.keys.slice(0,I.keys.length-1)}):w.push(I);for(const I of w){if(this.typeJobs.length>0){const S=[],D=[];for(let O=0;O<this.typeJobs.length;O++){const x=this.typeJobs[O];R.Util.isPrefixArray(x.keys,I.keys)&&(S.push(x),D.push(O))}const u=S.sort((O,x)=>O.keys.length-x.keys.length);for(const O of u)await O.job();const p=D.sort().reverse();for(const O of p)this.typeJobs.splice(O,1)}await I.job()}}};return N.DEFAULT_PROCESSING_MODE="1.1",N.ENTRY_HANDLERS=[new d.EntryHandlerArrayValue,new n.EntryHandlerKeywordContext,new c.EntryHandlerKeywordId,new f.EntryHandlerKeywordIncluded,new o.EntryHandlerKeywordGraph,new E.EntryHandlerKeywordNest,new h.EntryHandlerKeywordType,new _.EntryHandlerKeywordValue,new P.EntryHandlerKeywordAnnotation,new s.EntryHandlerContainer,new y.EntryHandlerKeywordUnknownFallback,new t.EntryHandlerPredicate,new a.EntryHandlerInvalidFallback],se.JsonLdParser=N,se}(function(l){var e=W&&W.__createBinding||(Object.create?function(d,s,a,t){t===void 0&&(t=a);var n=Object.getOwnPropertyDescriptor(s,a);(!n||("get"in n?!s.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(d,t,n)}:function(d,s,a,t){t===void 0&&(t=a),d[t]=s[a]}),r=W&&W.__exportStar||function(d,s){for(var a in d)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&e(s,d,a)};Object.defineProperty(l,"__esModule",{value:!0}),r($t(),l)})(Nt);const We="null:",xt=/^@[a-zA-Z]+$/;function Mr(l){return e=>e.termType!=="NamedNode"||!e.value.startsWith(We)?null:l.namedNode(e.value.slice(We.length))}function Jr(l){const e=Mr(l);return r=>{const d=e(r.subject),s=e(r.predicate),a=e(r.object),t=e(r.graph);return d||s||a||t?l.quad(d||r.subject,s||r.predicate,a||r.object,t||r.graph):r}}class Xr{constructor(e,{baseIRI:r=We,context:d=null,documentLoader:s,factory:a=Jt}={}){const t=new Nt.JsonLdParser({baseIRI:r,context:d,dataFactory:a,documentLoader:s,streamingProfile:!1});e.pipe(t);const n=Jr(a),o=new At.Transform({objectMode:!0,transform:(f,E,h)=>{h(null,n(f))}});function c(f){if(Array.isArray(f))return f.forEach(c);typeof f=="object"&&Object.entries(f).forEach(([E,h])=>{h&&!xt.test(h)&&!xt.test(E)&&o.emit("prefix",E,a.namedNode(h))})}return t.on("context",c),t.on("error",f=>o.destroy(f)),t.pipe(o),Xt(o)}}class tn extends Mt{constructor(e){super(Xr,e)}}export{tn as default};
